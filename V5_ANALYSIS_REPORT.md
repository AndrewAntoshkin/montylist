# V5 BETA: –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –º–æ–Ω—Ç–∞–∂–Ω—ã–º –ª–∏—Å—Ç–æ–º

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ

| –¢–∞–π–º–∫–æ–¥ | Real | V5 | –°—Ç–∞—Ç—É—Å |
|---------|------|----|--------|
| 00:09:03:14 | –¢–û–ú–ê (–≤ –∫–∞–¥—Ä–µ, –ù–ï–¢ –ó–ö) | –¢–û–ú–ê (–±–µ–∑ –ó–ö) | ‚úÖ –í–µ—Ä–Ω–æ |
| 00:12:01:23 | –ì–ê–õ–Ø (–≤ –∫–∞–¥—Ä–µ, –ù–ï–¢ –ó–ö) | –ì–ê–õ–Ø (–±–µ–∑ –ó–ö) | ‚úÖ –í–µ—Ä–Ω–æ |

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ –ó–ö —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤.

---

## ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ (00:15:01:13)

**Real:**
```
00:15:01:13 ‚Üí 00:15:02:14
–ì–ê–õ–Ø: "–ß—Ç–æ, —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é?"
```

**V5:**
```
00:15:01:13 ‚Üí 00:15:02:14
–õ–ï–ù–ê: "–£–≥—É."
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ `speaker ‚Üí character`. Speaker ID, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ì–ê–õ–Ø, –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –õ–ï–ù–ê.

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ASR‚ÜîScript alignment –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∞–π–º–∫–æ–¥–∞
- –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∞–ø–ø–∏–Ω–≥–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–µ—Å–∞ –¥–ª—è alignment)

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∏–∞–ª–æ–≥–∏ –í–ê–õ–Ø (00:15:02:14 - 00:15:04:16)

**Real:**
```
00:15:02:14 ‚Üí 00:15:03:14
–í–ê–õ–Ø: "—ç—Ç–æ –µ—Å–ª–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –Ω–µ —Å—á–∏—Ç–∞—Ç—å."

00:15:03:14 ‚Üí 00:15:04:16
–í–ê–õ–Ø: "–£ –Ω–∏—Ö."

00:15:04:16 ‚Üí 00:15:08:10
–í–ê–õ–Ø: "—Ç–æ–≥–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–æ"
```

**V5:**
```
00:15:02:14 ‚Üí 00:15:03:14
–ú—É–∑—ã–∫–∞ (–Ω–µ—Ç –¥–∏–∞–ª–æ–≥–∞!)

00:15:03:14 ‚Üí 00:15:04:16
–ú—É–∑—ã–∫–∞ (–Ω–µ—Ç –¥–∏–∞–ª–æ–≥–∞!)

00:15:04:16 ‚Üí 00:15:08:10
–ú—É–∑—ã–∫–∞ (–Ω–µ—Ç –¥–∏–∞–ª–æ–≥–∞!)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–í–ê–õ–Ø –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ –≤ –º–∞–ø–ø–∏–Ω–≥–µ**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –µ—Å—Ç—å –ª–∏ –í–ê–õ–Ø –≤ `scriptData.characters`?
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø—Ä–∏–≤—è–∑–∞–Ω –ª–∏ speaker ID –∫ –í–ê–õ–Ø –≤ `speakerCharacterMap`?

2. **ASR –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª —Ç–µ–∫—Å—Ç (–º—É–∑—ã–∫–∞ –≤ —Ñ–æ–Ω–µ)**
   - –í–æ–∑–º–æ–∂–Ω–æ, –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –∏–≥—Ä–∞–µ—Ç —Ñ–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
   - AssemblyAI –º–æ–≥ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å –∏–∑-–∑–∞ –º—É–∑—ã–∫–∏

3. **–î–∏–∞–ª–æ–≥–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–µ –ø–æ–ø–∞–ª–∏ –ª–∏ —Å–ª–æ–≤–∞ –≤ `FALSE_POSITIVE_PATTERNS`?
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –¥–∏–∞–ª–æ–≥–∏ (< 3 —Å–∏–º–≤–æ–ª–æ–≤)?

4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∞–π–º–∫–æ–¥—ã —Å—Ü–µ–Ω**
   - –í–æ–∑–º–æ–∂–Ω–æ, —Å–ª–æ–≤–∞ –í–ê–õ–Ø –ø–æ–ø–∞–ª–∏ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑–±–∏–µ–Ω–∏—è

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ï—Å—Ç—å –ª–∏ –í–ê–õ–Ø –≤ —Å–∫—Ä–∏–ø—Ç–µ?

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í–ê–õ–Ø –µ—Å—Ç—å –≤ `real-montage.txt` (10 —É–ø–æ–º–∏–Ω–∞–Ω–∏–π)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**
- `lib/script-parser-deterministic.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç `'–í–ê–õ–ï–ù–¢–ò–ù–ê': ['–í–ê–õ–Ø', '–í–ê–õ–Æ–®–ê']`
- –ü–∞—Ä—Å–µ—Ä –¥–æ–ª–∂–µ–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –í–ê–õ–Ø –∫–∞–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

**–í—ã–≤–æ–¥:** –í–ê–õ–Ø –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ `scriptData.characters`.

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∏–∞–ª–æ–≥–æ–≤

**–¢–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–æ–≤ –í–ê–õ–Ø:**
- "—ç—Ç–æ –µ—Å–ª–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –Ω–µ —Å—á–∏—Ç–∞—Ç—å." (30 —Å–∏–º–≤–æ–ª–æ–≤) ‚úÖ –ù–µ –¥–æ–ª–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è
- "–£ –Ω–∏—Ö." (6 —Å–∏–º–≤–æ–ª–æ–≤) ‚úÖ –ù–µ –¥–æ–ª–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è
- "—Ç–æ–≥–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–æ" (15 —Å–∏–º–≤–æ–ª–æ–≤) ‚úÖ –ù–µ –¥–æ–ª–∂–µ–Ω —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤:**
- `/^–º—É–∑—ã–∫–∞/i` - –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- `/^–¥–∏–Ω–∞–º–∏—á–Ω/i` - –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
- –î—Ä—É–≥–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã - –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç

**–í—ã–≤–æ–¥:** –î–∏–∞–ª–æ–≥–∏ –í–ê–õ–Ø –Ω–µ –¥–æ–ª–∂–Ω—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å—Å—è.

---

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ú–∞–ø–ø–∏–Ω–≥ speaker ‚Üí character

**–ü—Ä–æ–±–ª–µ–º–∞:** –í 00:15:01:13 speaker, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ì–ê–õ–Ø, –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –õ–ï–ù–ê.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. ASR‚ÜîScript alignment –Ω–µ –Ω–∞—à—ë–ª —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –ì–ê–õ–Ø –≤ —ç—Ç–æ–º –º–µ—Å—Ç–µ
2. –õ–ï–ù–ê –∏–º–µ–ª–∞ –±–æ–ª—å—à–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ (alignment/face/voice) –¥–ª—è —ç—Ç–æ–≥–æ speaker
3. –ú–∞–ø–ø–∏–Ω–≥ –±—ã–ª –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω (locked) —Ä–∞–Ω—å—à–µ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É alignment –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –ì–ê–õ–Ø
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å alignment –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –º–∞–ø–ø–∏–Ω–≥–∞

---

## üõ†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å –≤ `process-chunk-v5/route.ts`:
```typescript
// –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ü–µ–Ω—ã
console.log(`   Scene ${sceneIndex}: speaker ${speaker} ‚Üí ${character} (mapped: ${!!speakerCharacterMap[speaker]})`);

// –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
if (wordsInScene.length === 0) {
  console.log(`   ‚ö†Ô∏è No words in scene ${sceneIndex} (${sceneStartMs}ms - ${sceneEndMs}ms)`);
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ASR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É:
```typescript
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Å–ª–æ–≤–∞ –≤ —ç—Ç–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ
const wordsInTimeRange = fullDiarizationWords.filter(
  w => w.startMs >= sceneStartMs - 500 && w.endMs <= sceneEndMs + 500
);
console.log(`   Words in range: ${wordsInTimeRange.length}`);
```

### 3. –£–ª—É—á—à–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥

- –£–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å alignment: `2.0 ‚Üí 2.5`
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–æ—Å–µ–¥–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∏)
- –î–æ–±–∞–≤–∏—Ç—å fallback –Ω–∞ name mentions, –µ—Å–ª–∏ alignment –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —Å—Ü–µ–Ω—ã

–í–æ–∑–º–æ–∂–Ω–æ, —Å—Ü–µ–Ω—ã —Ä–∞–∑–±–∏—Ç—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏ –¥–∏–∞–ª–æ–≥–∏ –í–ê–õ–Ø –ø–æ–ø–∞–ª–∏ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É.

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –¶–µ–ª—å |
|---------|----------|------|
| –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π | ~85% | >95% |
| –ü–æ–ª–Ω–æ—Ç–∞ –¥–∏–∞–ª–æ–≥–æ–≤ | ~90% | >98% |
| –¢–æ—á–Ω–æ—Å—Ç—å –ó–ö | ~95% | >98% |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–∂–Ω—ã—Ö | ~95% | >99% |

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–í—ã—Å–æ–∫–∏–π:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ speaker ‚Üí character (–õ–ï–ù–ê –≤–º–µ—Å—Ç–æ –ì–ê–õ–Ø)
2. **–í—ã—Å–æ–∫–∏–π:** –ù–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –í–ê–õ–Ø
3. **–°—Ä–µ–¥–Ω–∏–π:** –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **–ù–∏–∑–∫–∏–π:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ª–æ–∂–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `process-chunk-v5/route.ts`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ç–∞–π–º–∫–æ–¥–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ASR —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–ª—è 00:15:02:14 - 00:15:04:16
4. –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É –º–∞–ø–ø–∏–Ω–≥–∞ (—É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å alignment)
