/**
 * –ü—Ä–æ–º–ø—Ç—ã v2 ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ, —á—ë—Ç–∫–∏–µ, –±–µ–∑ –º—É—Å–æ—Ä–∞
 * 
 * –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∞–Ω–∞–ª–∏–∑–µ –†–ï–ê–õ–¨–ù–û–ì–û –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞:
 * - –¢–∞–π–º–∫–æ–¥—ã –í–°–¢–´–ö (–∫–æ–Ω–µ—Ü –æ–¥–Ω–æ–≥–æ = –Ω–∞—á–∞–ª–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ)
 * - "–¢–∏—Ç—Ä" –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
 * - –î–∏–∞–ª–æ–≥–∏ –†–ê–ó–†–ï–ó–ê–Æ–¢–°–Ø –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏
 * - –í–∏–¥ –ø–ª–∞–Ω–∞: –ö—Ä./–°—Ä./–û–±—â. + –ù–î–ü –ø—Ä–∏ —Ç–∏—Ç—Ä–∞—Ö
 */

import { type MergedScene } from './credits-detector';

/**
 * –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Ü–µ–Ω
 * –ö–æ—Ä–æ—Ç–∫–∏–π –∏ —á—ë—Ç–∫–∏–π ‚Äî —Ç–æ–ª—å–∫–æ —Å—É—Ç—å
 */
export function createMainPrompt(
  scenes: Array<{ start_timecode: string; end_timecode: string }>,
  characterRegistry: string = ''
): string {
  // –ù–ï –Ω—É–º–µ—Ä—É–µ–º –ø–ª–∞–Ω—ã! –ò–Ω–∞—á–µ Gemini –≤—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ –≤ —Ç–µ–∫—Å—Ç
  const sceneList = scenes
    .map((s) => `${s.start_timecode} - ${s.end_timecode}`)
    .join('\n');

  return `–û–ø–∏—à–∏ ${scenes.length} –ø–ª–∞–Ω–æ–≤ –≤–∏–¥–µ–æ. –¢–∞–π–º–∫–æ–¥—ã –§–ò–ö–°–ò–†–û–í–ê–ù–´ ‚Äî –Ω–µ –º–µ–Ω—è–π –∏—Ö.

–ü–õ–ê–ù–´:
${sceneList}
${characterRegistry ? `\n–ü–ï–†–°–û–ù–ê–ñ–ò:\n${characterRegistry}` : ''}

–î–õ–Ø –ö–ê–ñ–î–û–ì–û –ü–õ–ê–ù–ê –ù–ê–ü–ò–®–ò:

**–¢–ê–ô–ú–ö–û–î**
–í–∏–¥: [–ö—Ä./–°—Ä./–û–±—â.] [–ù–î–ü –µ—Å–ª–∏ —Ç–∏—Ç—Ä—ã]
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: [–ö—Ç–æ –≤ –∫–∞–¥—Ä–µ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç]
${scenes.length > 0 && scenes[0].start_timecode.startsWith('00:0') ? '–ï—Å–ª–∏ —Ç–∏—Ç—Ä ‚Äî —Å–ª–æ–≤–æ "–¢–∏—Ç—Ä" –∏ —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ' : ''}
–î–∏–∞–ª–æ–≥–∏: [–ò–ú–Ø —Ç–µ–∫—Å—Ç] –∏–ª–∏ "–ú—É–∑—ã–∫–∞"

–§–û–†–ú–ê–¢ –î–ò–ê–õ–û–ì–û–í:
- –ò–ú–Ø ‚Äî –µ—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –≥–æ–≤–æ—Ä–∏—Ç –ò –í–ò–î–ï–ù –≤ –∫–∞–¥—Ä–µ
- –ò–ú–Ø –ó–ö ‚Äî –µ—Å–ª–∏ –≥–æ–ª–æ—Å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å–ª—ã—à–µ–Ω, –Ω–æ –µ–≥–æ –ù–ï –í–ò–î–ù–û –≤ –∫–∞–¥—Ä–µ (–∑–∞ –∫–∞–¥—Ä–æ–º)
- –ö–∞–∂–¥–∞—è —Ä–µ–ø–ª–∏–∫–∞ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ

–ü–†–ò–ú–ï–† 1 (—Ç–∏—Ç—Ä—ã):
**00:01:06:13 - 00:01:09:09**
–í–∏–¥: –°—Ä. –ù–î–ü
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –¢–æ–º–∞ –∏–¥–µ—Ç –ø–æ —Å–∞–ª–æ–Ω—É.
–¢–∏—Ç—Ä
–ì–∞–ª–∏–Ω–∞ ‚Äì –ü–æ–ª–∏–Ω–∞ –ù–µ—á–∏—Ç–∞–π–ª–æ
–î–∏–∞–ª–æ–≥–∏: –¢–û–ú–ê
–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ, –ø—Ä–∏—Å–∞–∂–∏–≤–∞–π—Ç–µ—Å—å.

–ü–†–ò–ú–ï–† 2 (–ó–ö):
**00:08:02:07 - 00:08:07:10**
–í–∏–¥: –û–±—â.
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –ì–∞–ª—è —Ç–∞–Ω—Ü—É–µ—Ç –ø–µ—Ä–µ–¥ –Æ—Å–µ—Ñ–æ–º. –Æ—Å–µ—Ñ —Å–∏–¥–∏—Ç –∑–∞ —Å—Ç–æ–ª–æ–º.
–î–∏–∞–ª–æ–≥–∏: –ì–ê–õ–Ø –ó–ö
–° —Ñ–∞–±—Ä–∏–∫–∏. –¢–∞–∫ —Å—Ä–∞–∑—É –ª–∞–ø–∞–ª –∫–∞–∫ –Ω–∞ —Å–≤–∏–¥–∞–Ω–∏–µ –∑–≤–∞–ª. –ñ—É—Ç—å!

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û ‚Äî –°–ü–õ–ò–¢ –†–ï–ü–õ–ò–ö:
- –ü–∏—à–∏ –¢–û–õ–¨–ö–û —Ç–µ —Å–ª–æ–≤–∞, —á—Ç–æ –ó–í–£–ß–ê–¢ –≤ —ç—Ç–æ–º –ø–ª–∞–Ω–µ!
- –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ –≥–æ–≤–æ—Ä–∏—Ç –¥–ª–∏–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫—É, –∞ –ø–ª–∞–Ω –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –†–ê–ó–î–ï–õ–ò —Ä–µ–ø–ª–∏–∫—É –º–µ–∂–¥—É –ø–ª–∞–Ω–∞–º–∏
- –ù–ï –ü–û–í–¢–û–†–Ø–ô —Ç–µ–∫—Å—Ç –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–ª–∞–Ω–∞!

–ó–ê–ü–†–ï–©–ï–ù–û:
- –ù–ï –¥–æ–±–∞–≤–ª—è–π —Å–≤–æ—é –Ω—É–º–µ—Ä–∞—Ü–∏—é (1., 2., 3...) ‚Äî –ø–ª–∞–Ω –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –ø–æ —Ç–∞–π–º–∫–æ–¥—É
- –ù–ï –ø–∏—à–∏ "–ù–µ—Ç" –µ—Å–ª–∏ –Ω–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤ ‚Äî –ø–∏—à–∏ "‚Äî" –∏–ª–∏ "–ú—É–∑—ã–∫–∞"
- –ù–ï –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ! –ö–ê–ñ–î–´–ô –ø–ª–∞–Ω –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —á—Ç–æ –≤ –∫–∞–¥—Ä–µ!

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –ö–ê–ñ–î–û–ì–û –ø–ª–∞–Ω–∞:
- –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –í–°–ï–ì–î–ê –æ–ø–∏—Å—ã–≤–∞–π —á—Ç–æ –≤–∏–¥–Ω–æ –≤ –∫–∞–¥—Ä–µ (–¥–∞–∂–µ –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—å–µ—Ä –∏–ª–∏ —Ä—É–∫–∏)

–û–ø–∏—à–∏ –≤—Å–µ ${scenes.length} –ø–ª–∞–Ω–æ–≤.`;
}

/**
 * v3 JSON prompt ‚Äî —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –û–ë–™–ï–î–ò–ù–ï–ù–ò–Ø –ø–ª–∞–Ω–æ–≤ (–∑–∞—Å—Ç–∞–≤–∫–∞, –ª–æ–≥–æ—Ç–∏–ø)
 * 
 * FFmpeg –¥–∞—ë—Ç –í–°–ï —Å–∫–ª–µ–π–∫–∏, –Ω–æ Gemini –º–æ–∂–µ—Ç –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å:
 * - –õ–æ–≥–æ—Ç–∏–ø (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫–ª–µ–µ–∫ ‚Üí 1 –ø–ª–∞–Ω)
 * - –ó–∞—Å—Ç–∞–≤–∫–∞ (–º–Ω–æ–≥–æ —Å–∫–ª–µ–µ–∫ ‚Üí 1 –ø–ª–∞–Ω)
 * - –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∏—Ç—Ä—ã (–º–Ω–æ–≥–æ —Å–∫–ª–µ–µ–∫ ‚Üí 1 –ø–ª–∞–Ω)
 */
export function createMainPromptJson(
  scenes: Array<{ start_timecode: string; end_timecode: string }>,
  characterRegistry: string = ''
): string {
  const sceneList = scenes
    .map((s, i) => `${i + 1}. ${s.start_timecode} - ${s.end_timecode}`)
    .join('\n');

  return `üé¨ –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ–Ω—Ç–∞–∂–Ω—ã–π –ª–∏—Å—Ç.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìê –°–ö–õ–ï–ô–ö–ò –û–¢ FFMPEG (${scenes.length} —à—Ç.):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${sceneList}
${characterRegistry ? `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìã –ü–ï–†–°–û–ù–ê–ñ–ò:\n${characterRegistry}` : ''}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ –¢–í–û–Ø –ó–ê–î–ê–ß–ê: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å–∫–ª–µ–π–∫–∏ –≤ –ü–õ–ê–ù–´
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üö® –ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –ö–ê–ñ–î–ê–Ø –°–ö–õ–ï–ô–ö–ê = –û–¢–î–ï–õ–¨–ù–´–ô –ü–õ–ê–ù!

**–ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø (–º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å):**
- –õ–æ–≥–æ—Ç–∏–ø —Å—Ç—É–¥–∏–∏ (–ø–µ—Ä–≤—ã–µ 3-6 —Å–µ–∫) ‚Üí 1 –ø–ª–∞–Ω
- –ó–∞—Å—Ç–∞–≤–∫–∞ —Å —Ç–∏—Ç—Ä–∞–º–∏ –∞–∫—Ç—ë—Ä–æ–≤ ‚Üí 1 –ø–ª–∞–Ω  
- –§–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∏—Ç—Ä—ã/credits ‚Üí 1 –ø–ª–∞–Ω

**–ù–ï–õ–¨–ó–Ø –û–ë–™–ï–î–ò–ù–Ø–¢–¨:**
‚ùå –†–∞–∑–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏ (—Ä–µ—Å—Ç–æ—Ä–∞–Ω ‚Üí —Å–∞–ª–æ–Ω = 2 –ü–õ–ê–ù–ê!)
‚ùå –†–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω—ã (–¥–∞–∂–µ –∫–æ—Ä–æ—Ç–∫–∏–µ = –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã)
‚ùå –°–º–µ–Ω—É –º–µ—Å—Ç–∞ –¥–µ–π—Å—Ç–≤–∏—è

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å "–°–º–µ–Ω–∞ –∫–∞–¥—Ä–∞" –∏–ª–∏ "–°–º–µ–Ω–∞ –ª–æ–∫–∞—Ü–∏–∏" ‚Äî —ç—Ç–æ –†–ê–ó–ù–´–ï –ø–ª–∞–Ω—ã!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–í–µ—Ä–Ω–∏ JSON –º–∞—Å—Å–∏–≤ –≤ –±–ª–æ–∫–µ \`\`\`json\`\`\`:

{
  "start": "–ß–ß:–ú–ú:–°–°:–ö–ö",
  "end": "–ß–ß:–ú–ú:–°–°:–ö–ö",
  "plan_type": "–ö—Ä.|–°—Ä.|–û–±—â.|–î–µ—Ç–∞–ª—å|–ù–î–ü (+ –ù–î–ü –µ—Å–ª–∏ —Ç–∏—Ç—Ä—ã)",
  "content_summary": "–û–ø–∏—Å–∞–Ω–∏–µ. –ï—Å–ª–∏ —Ç–∏—Ç—Ä—ã ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ.",
  "dialogue": "–ò–ú–Ø\\n—Ç–µ–∫—Å—Ç –∏–ª–∏ –ú—É–∑—ã–∫–∞"
}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –ü–†–ò–ú–ï–†–´
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**–ü—Ä–∏–º–µ—Ä 1: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ª–æ–≥–æ—Ç–∏–ø–∞ (—Å–∫–ª–µ–π–∫–∏ 1-3 ‚Üí 1 –ø–ª–∞–Ω)**
\`\`\`json
[
  {
    "start": "00:00:00:00",
    "end": "00:00:04:09",
    "plan_type": "–ù–î–ü",
    "content_summary": "–õ–æ–≥–æ—Ç–∏–ø. –¢–µ–ª–µ–∫–æ–º–ø–∞–Ω–∏—è –ü–∞—Ä—Ç–Ω–µ—Ä.",
    "dialogue": "–ú—É–∑—ã–∫–∞"
  }
]
\`\`\`

**–ü—Ä–∏–º–µ—Ä 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞—Å—Ç–∞–≤–∫–∏ (—Å–∫–ª–µ–π–∫–∏ 4-35 ‚Üí 1 –ø–ª–∞–Ω)**
\`\`\`json
[
  {
    "start": "00:00:04:09",
    "end": "00:01:06:13",
    "plan_type": "–°—Ä. –ù–î–ü",
    "content_summary": "–ó–∞—Å—Ç–∞–≤–∫–∞.\\n–¢–∏—Ç—Ä: –¢–µ–ª–µ–∫–∞–Ω–∞–ª –î–æ–º–∞—à–Ω–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç.\\n–¢–∏—Ç—Ä ¬´–®—É—Ä–æ—á–∫–∞. –¢–∞—Ç—å—è–Ω–∞ –†—ã–±–∏–Ω–µ—Ü¬ª.\\n–¢–∏—Ç—Ä ¬´–ë—ç–ª–ª–∞. –ü–æ–ª–∏–Ω–∞ –ì–∞–Ω—à–∏–Ω–∞¬ª.\\n–¢–∏—Ç—Ä ¬´–¢–æ–º–∞. –ê–ª—ë–Ω–∞ –•–º–µ–ª—å–Ω–∏—Ü–∫–∞—è¬ª.\\n–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞.",
    "dialogue": "–ú—É–∑—ã–∫–∞"
  }
]
\`\`\`

**–ü—Ä–∏–º–µ—Ä 3: –û–±—ã—á–Ω–∞—è —Å—Ü–µ–Ω–∞ (1 —Å–∫–ª–µ–π–∫–∞ = 1 –ø–ª–∞–Ω)**
\`\`\`json
[
  {
    "start": "00:01:06:13",
    "end": "00:01:09:09",
    "plan_type": "–°—Ä. –ù–î–ü",
    "content_summary": "–¢–æ–º–∞ –∏–¥–µ—Ç –ø–æ —Å–∞–ª–æ–Ω—É.\\n–¢–∏—Ç—Ä\\n–ì–∞–ª–∏–Ω–∞ ‚Äì –ü–æ–ª–∏–Ω–∞ –ù–µ—á–∏—Ç–∞–π–ª–æ",
    "dialogue": "–¢–û–ú–ê\\n–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ, –ø—Ä–∏—Å–∞–∂–∏–≤–∞–π—Ç–µ—Å—å."
  }
]
\`\`\`

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è –ü–†–ê–í–ò–õ–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. **–¢–ê–ô–ú–ö–û–î–´ –í–°–¢–´–ö** ‚Äî –∫–æ–Ω–µ—Ü –ø–ª–∞–Ω–∞ = –Ω–∞—á–∞–ª–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ
2. **–û–ë–™–ï–î–ò–ù–Ø–ô –¢–û–õ–¨–ö–û:** –ª–æ–≥–æ—Ç–∏–ø, –∑–∞—Å—Ç–∞–≤–∫—É, —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∏—Ç—Ä—ã
3. **–ö–ê–ñ–î–ê–Ø –°–ö–õ–ï–ô–ö–ê = –ü–õ–ê–ù!** –ù–µ –æ–±—ä–µ–¥–∏–Ω—è–π –æ–±—ã—á–Ω—ã–µ —Å—Ü–µ–Ω—ã!
4. **–†–ê–ó–ù–´–ï –õ–û–ö–ê–¶–ò–ò = –†–ê–ó–ù–´–ï –ü–õ–ê–ù–´!** (—Ä–µ—Å—Ç–æ—Ä–∞–Ω ‚â† —Å–∞–ª–æ–Ω)
5. **–î–ò–ê–õ–û–ì–ò** ‚Äî –ò–ú–Ø –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ, –ø–æ—Ç–æ–º —Ç–µ–∫—Å—Ç
6. **–û–ü–ò–°–ê–ù–ò–ï** ‚Äî –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç—ã–º!

üö® –ó–ê–ü–†–ï–©–ï–ù–û –ø–∏—Å–∞—Ç—å "–°–º–µ–Ω–∞ –∫–∞–¥—Ä–∞" –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç —Ç—ã –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û –æ–±—ä–µ–¥–∏–Ω–∏–ª —Ä–∞–∑–Ω—ã–µ –ø–ª–∞–Ω—ã!

–ù–∞—á–∏–Ω–∞–π –∞–Ω–∞–ª–∏–∑!`;
}


/**
 * –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ø—Ä–æ–º–ø—Ç –¥–ª—è –ù–ê–ß–ê–õ–ê –í–ò–î–ï–û
 * AI —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –õ–Æ–ë–û–ì–û —Ç–∏–ø–∞ –≤–∏–¥–µ–æ:
 * - –°–µ—Ä–∏–∞–ª —Å –∑–∞—Å—Ç–∞–≤–∫–æ–π
 * - –§–∏–ª—å–º –±–µ–∑ –∑–∞—Å—Ç–∞–≤–∫–∏
 * - –î–æ–∫—É–º–µ–Ω—Ç–∞–ª–∫–∞
 * - –†–µ–∫–ª–∞–º–∞
 * - –ö–ª–∏–ø
 */
export function createOpeningPromptAIFirst(
  endTimecode: string,
  characterRegistry: string = ''
): string {
  return `üé¨ –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ô –º–æ–Ω—Ç–∞–∂–Ω—ã–π –ª–∏—Å—Ç –¥–ª—è –ù–ê–ß–ê–õ–ê –≤–∏–¥–µ–æ.

üìπ –ê–ù–ê–õ–ò–ó–ò–†–£–ï–ú–´–ô –§–†–ê–ì–ú–ï–ù–¢: 00:00:00:00 - ${endTimecode}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –®–ê–ì 1: –û–ü–†–ï–î–ï–õ–ò –¢–ò–ü –ù–ê–ß–ê–õ–ê –í–ò–î–ï–û
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ü–æ—Å–º–æ—Ç—Ä–∏ –ø–µ—Ä–≤—ã–µ 2 –º–∏–Ω—É—Ç—ã –∏ –æ–ø—Ä–µ–¥–µ–ª–∏ —á—Ç–æ —Ç–∞–º:

**–í–ê–†–ò–ê–ù–¢ A: –ï—Å—Ç—å –ª–æ–≥–æ—Ç–∏–ø + –∑–∞—Å—Ç–∞–≤–∫–∞ (—Ç–∏–ø–∏—á–Ω–æ –¥–ª—è —Å–µ—Ä–∏–∞–ª–æ–≤)**
- –õ–æ–≥–æ—Ç–∏–ø —Å—Ç—É–¥–∏–∏/–∫–∞–Ω–∞–ª–∞ (–æ–±—ã—á–Ω–æ 2-10 —Å–µ–∫) ‚Üí –û–î–ò–ù –ø–ª–∞–Ω
- –ó–∞—Å—Ç–∞–≤–∫–∞ —Å —Ç–∏—Ç—Ä–∞–º–∏ –∞–∫—Ç—ë—Ä–æ–≤ (–æ–±—ã—á–Ω–æ 30-90 —Å–µ–∫) ‚Üí –û–î–ò–ù –ø–ª–∞–Ω  
- –ó–∞—Ç–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ü–µ–Ω—ã —Ñ–∏–ª—å–º–∞ ‚Üí –∫–∞–∂–¥–∞—è —Å–∫–ª–µ–π–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ

**–í–ê–†–ò–ê–ù–¢ B: –¢–æ–ª—å–∫–æ –∑–∞—Å—Ç–∞–≤–∫–∞, –±–µ–∑ –ª–æ–≥–æ—Ç–∏–ø–∞**
- –ó–∞—Å—Ç–∞–≤–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É ‚Üí –û–î–ò–ù –ø–ª–∞–Ω
- –ó–∞—Ç–µ–º –ø–µ—Ä–≤—ã–µ —Å—Ü–µ–Ω—ã

**–í–ê–†–ò–ê–ù–¢ C: –ù–µ—Ç –∑–∞—Å—Ç–∞–≤–∫–∏ (–¥–æ–∫—É–º–µ–Ω—Ç–∞–ª–∫–∞, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∏–ª—å–º—ã)**
- –°—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å—Ü–µ–Ω—ã —Ñ–∏–ª—å–º–∞ ‚Üí –∫–∞–∂–¥–∞—è —Å–∫–ª–µ–π–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- –í–æ–∑–º–æ–∂–Ω–æ —Ç–∏—Ç—Ä—ã –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –Ω–∞ —Å—Ü–µ–Ω—ã (–¥–æ–±–∞–≤—å –ù–î–ü)

**–í–ê–†–ò–ê–ù–¢ D: –õ–æ–≥–æ—Ç–∏–ø—ã –±–µ–∑ –∑–∞—Å—Ç–∞–≤–∫–∏**
- –û–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ ‚Üí –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω
- –ó–∞—Ç–µ–º —Å—Ä–∞–∑—É —Å—Ü–µ–Ω—ã —Ñ–∏–ª—å–º–∞

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –®–ê–ì 2: –ö–ê–ö –û–§–û–†–ú–õ–Ø–¢–¨ –ö–ê–ñ–î–´–ô –¢–ò–ü
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**–õ–û–ì–û–¢–ò–ü (–µ—Å–ª–∏ –µ—Å—Ç—å):**
- –°—Ç–∞—Ç–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—è –ª–æ–≥–æ—Ç–∏–ø–∞ –∫–æ–º–ø–∞–Ω–∏–∏
- –ü—Ä–∏–º–µ—Ä: "–õ–æ–≥–æ—Ç–∏–ø. –¢–µ–ª–µ–∫–æ–º–ø–∞–Ω–∏—è –ü–∞—Ä—Ç–Ω–µ—Ä."
- –¢–∏–ø –ø–ª–∞–Ω–∞: –ù–î–ü

**–ó–ê–°–¢–ê–í–ö–ê (–µ—Å–ª–∏ –µ—Å—Ç—å):**
- –≠—Ç–æ –û–î–ò–ù –ø–ª–∞–Ω, –¥–∞–∂–µ –µ—Å–ª–∏ –≤–Ω—É—Ç—Ä–∏ –º–Ω–æ–≥–æ —Å–º–µ–Ω –∏ —Ç–∏—Ç—Ä–æ–≤!
- –ü–µ—Ä–µ—á–∏—Å–ª–∏ –í–°–ï —Ç–∏—Ç—Ä—ã —Å –∏–º–µ–Ω–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –∞–∫—Ç—ë—Ä–æ–≤
- –§–æ—Ä–º–∞—Ç: "–ó–∞—Å—Ç–∞–≤–∫–∞.\\n–¢–∏—Ç—Ä ¬´–ü–µ—Ä—Å–æ–Ω–∞–∂. –ê–∫—Ç—ë—Ä¬ª.\\n–¢–∏—Ç—Ä ¬´–ü–µ—Ä—Å–æ–Ω–∞–∂. –ê–∫—Ç—ë—Ä¬ª."
- –¢–∏–ø –ø–ª–∞–Ω–∞: –°—Ä. –ù–î–ü (–∏–ª–∏ –ö—Ä. –ù–î–ü)

**–ü–ï–†–í–´–ï –°–¶–ï–ù–´ (–ø–æ—Å–ª–µ –∑–∞—Å—Ç–∞–≤–∫–∏ –∏–ª–∏ —Å—Ä–∞–∑—É):**
- –ö–ê–ñ–î–ê–Ø –º–æ–Ω—Ç–∞–∂–Ω–∞—è —Å–∫–ª–µ–π–∫–∞ = –û–¢–î–ï–õ–¨–ù–´–ô –ø–ª–∞–Ω
- –î–∞–∂–µ –µ—Å–ª–∏ –¥–ª–∏—Ç—Å—è 1 —Å–µ–∫—É–Ω–¥—É
- –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∏—Ç—Ä—ã –ø–æ–≤–µ—Ä—Ö —Å—Ü–µ–Ω—ã ‚Üí –¥–æ–±–∞–≤—å –ù–î–ü –∫ —Ç–∏–ø—É –ø–ª–∞–Ω–∞

${characterRegistry ? `\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nüìã –ü–ï–†–°–û–ù–ê–ñ–ò (–∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –∏–º–µ–Ω–∞!):\n${characterRegistry}\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê` : ''}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìã –®–ê–ì 3: –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON –º–∞—Å—Å–∏–≤ –≤ –±–ª–æ–∫–µ \`\`\`json\`\`\`:

\`\`\`json
[
  {
    "start": "00:00:00:00",
    "end": "00:00:04:09",
    "plan_type": "–ù–î–ü",
    "content_summary": "–õ–æ–≥–æ—Ç–∏–ø. –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏.",
    "dialogue": "–ú—É–∑—ã–∫–∞"
  },
  {
    "start": "00:00:04:09",
    "end": "00:01:06:13",
    "plan_type": "–°—Ä. –ù–î–ü",
    "content_summary": "–ó–∞—Å—Ç–∞–≤–∫–∞.\\n–¢–∏—Ç—Ä: –¢–µ–ª–µ–∫–∞–Ω–∞–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç.\\n–¢–∏—Ç—Ä ¬´–®—É—Ä–æ—á–∫–∞. –¢–∞—Ç—å—è–Ω–∞ –†—ã–±–∏–Ω–µ—Ü¬ª.\\n–¢–∏—Ç—Ä ¬´–ë—ç–ª–ª–∞. –ü–æ–ª–∏–Ω–∞ –ì–∞–Ω—à–∏–Ω–∞¬ª.\\n–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞.",
    "dialogue": "–ú—É–∑—ã–∫–∞"
  },
  {
    "start": "00:01:06:13",
    "end": "00:01:09:09",
    "plan_type": "–°—Ä. –ù–î–ü",
    "content_summary": "–¢–æ–º–∞ –∏–¥–µ—Ç –ø–æ —Å–∞–ª–æ–Ω—É.\\n–¢–∏—Ç—Ä\\n–ì–∞–ª–∏–Ω–∞ ‚Äì –ü–æ–ª–∏–Ω–∞ –ù–µ—á–∏—Ç–∞–π–ª–æ",
    "dialogue": "–¢–û–ú–ê\\n–ü—Ä–æ—Ö–æ–¥–∏—Ç–µ, –ø—Ä–∏—Å–∞–∂–∏–≤–∞–π—Ç–µ—Å—å."
  },
  {
    "start": "00:01:09:09",
    "end": "00:01:12:15",
    "plan_type": "–ö—Ä.",
    "content_summary": "–ì–∞–ª—è —Å–∞–¥–∏—Ç—Å—è –Ω–∞ –∫—É—à–µ—Ç–∫—É.",
    "dialogue": "–ì–ê–õ–Ø\\n–°–ø–∞—Å–∏–±–æ."
  }
]
\`\`\`

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. **–¢–ê–ô–ú–ö–û–î–´ –í–°–¢–´–ö** ‚Äî –∫–æ–Ω–µ—Ü –ø–ª–∞–Ω–∞ N = –Ω–∞—á–∞–ª–æ –ø–ª–∞–Ω–∞ N+1
2. **–ó–ê–°–¢–ê–í–ö–ê = –û–î–ò–ù –ü–õ–ê–ù** ‚Äî –Ω–µ —Ä–∞–∑–±–∏–≤–∞–π –Ω–∞ —á–∞—Å—Ç–∏!
3. **–ü–û–°–õ–ï –ó–ê–°–¢–ê–í–ö–ò** ‚Äî –∫–∞–∂–¥–∞—è —Å–∫–ª–µ–π–∫–∞ = –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω
4. **–¢–ò–¢–†–´ –í –ó–ê–°–¢–ê–í–ö–ï** ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ –í–°–ï –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –∞–∫—Ç—ë—Ä–æ–≤
5. **–î–ò–ê–õ–û–ì–ò** ‚Äî —Ñ–æ—Ä–º–∞—Ç: –ò–ú–Ø\\n—Ç–µ–∫—Å—Ç (–∏–º—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ)
6. **–û–ü–ò–°–ê–ù–ò–ï** ‚Äî –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å—Ç–∞–≤–ª—è–π –ø—É—Å—Ç—ã–º!

–û–ø—Ä–µ–¥–µ–ª–∏ —Ç–∞–π–º–∫–æ–¥—ã –ø–æ –≤–∏–¥–µ–æ. –ù–∞—á–∏–Ω–∞–π!`;
}

/**
 * –ü—Ä–æ–º–ø—Ç –¥–ª—è –ó–ê–°–¢–ê–í–ö–ò (opening credits) - legacy
 * –û–¥–∏–Ω –¥–ª–∏–Ω–Ω—ã–π –ø–ª–∞–Ω —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ–≥–æ
 */
export function createOpeningCreditsPrompt(
  startTimecode: string,
  endTimecode: string,
  originalScenesCount: number
): string {
  return `–û–ø–∏—à–∏ –ó–ê–°–¢–ê–í–ö–£ —Ñ–∏–ª—å–º–∞ –∫–∞–∫ –û–î–ò–ù –ø–ª–∞–Ω.

–¢–ê–ô–ú–ö–û–î: ${startTimecode} - ${endTimecode}
(–≠—Ç–æ –∑–∞—Å—Ç–∞–≤–∫–∞ ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ ${originalScenesCount} –±—ã—Å—Ç—Ä—ã—Ö —Å—Ü–µ–Ω –≤ –æ–¥–∏–Ω –ø–ª–∞–Ω)

–ó–ê–î–ê–ß–ê: –û–ø–∏—à–∏ –í–°–Å —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –∑–∞—Å—Ç–∞–≤–∫–µ –ü–û–î–†–û–ë–ù–û:
- –õ–æ–≥–æ—Ç–∏–ø—ã –∫–∞–Ω–∞–ª–æ–≤/—Å—Ç—É–¥–∏–π
- –í—Å–µ —Ç–∏—Ç—Ä—ã —Å –∏–º–µ–Ω–∞–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ –∞–∫—Ç—ë—Ä–æ–≤
- –í—Å–µ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω—ã (–∫—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, —á—Ç–æ –¥–µ–ª–∞–µ—Ç)
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞/—Å–µ—Ä–∏–∞–ª–∞

–§–û–†–ú–ê–¢:
**${startTimecode} - ${endTimecode}**
–í–∏–¥: –°—Ä. –ù–î–ü
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –ó–∞—Å—Ç–∞–≤–∫–∞.
[–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–≥–æ: –ª–æ–≥–æ—Ç–∏–ø—ã, —Ç–∏—Ç—Ä—ã, –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π]
–î–∏–∞–ª–æ–≥–∏: –ú—É–∑—ã–∫–∞

–ü–†–ò–ú–ï–† –Ω–∞—á–∞–ª–∞:
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –ó–∞—Å—Ç–∞–≤–∫–∞.
–õ–æ–≥–æ—Ç–∏–ø. –¢–µ–ª–µ–∫–æ–º–ø–∞–Ω–∏—è –ü–∞—Ä—Ç–Ω–µ—Ä.
–ù–∞ —Ñ–æ–Ω–µ –ª–∏—Ü–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–∏—Ç—Ä: –¢–µ–ª–µ–∫–∞–Ω–∞–ª "–î–æ–º–∞—à–Ω–∏–π" –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç.
–®—É—Ä–æ—á–∫–∞ —Ä–∏—Å—É–µ—Ç —Å–µ—Ä–¥—Ü–µ –Ω–∞ —Å—Ç–µ–∫–ª–µ. –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–∏—Ç—Ä ¬´–®—É—Ä–æ—á–∫–∞. –¢–∞—Ç—å—è–Ω–∞ –†—ã–±–∏–Ω–µ—Ü¬ª.
–ë—ç–ª–ª–∞ —Å –≥–∞–Ω—Ç–µ–ª—è–º–∏. –¢–∏—Ç—Ä ¬´–ë—ç–ª–ª–∞. –ü–æ–ª–∏–Ω–∞ –ì–∞–Ω—à–∏–Ω–∞¬ª.
[–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ...]

–í–ê–ñ–ù–û: –ò–∑–≤–ª–µ–∫–∏ –í–°–ï –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏–∑ —Ç–∏—Ç—Ä–æ–≤!`;
}


/**
 * –ü—Ä–æ–º–ø—Ç –¥–ª—è –§–ò–ù–ê–õ–¨–ù–´–• –¢–ò–¢–†–û–í (closing credits)
 * –û–¥–∏–Ω –ø–ª–∞–Ω —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º —Å—ä—ë–º–æ—á–Ω–æ–π –≥—Ä—É–ø–ø—ã
 */
export function createClosingCreditsPrompt(
  startTimecode: string,
  endTimecode: string,
  originalScenesCount: number
): string {
  return `–û–ø–∏—à–∏ –§–ò–ù–ê–õ–¨–ù–´–ï –¢–ò–¢–†–´ –∫–∞–∫ –û–î–ò–ù –ø–ª–∞–Ω.

–¢–ê–ô–ú–ö–û–î: ${startTimecode} - ${endTimecode}
(–≠—Ç–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∏—Ç—Ä—ã ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–æ ${originalScenesCount} —Å—Ü–µ–Ω)

–ó–ê–î–ê–ß–ê: –ü–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ—Ö –∏–∑ —Å—ä—ë–º–æ—á–Ω–æ–π –≥—Ä—É–ø–ø—ã:
- —Ä–µ–∂–∏—Å—Å—ë—Ä-–ø–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫
- –∞–≤—Ç–æ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏—è  
- –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
- —Ö—É–¥–æ–∂–Ω–∏–∫–∏
- –ø—Ä–æ–¥—é—Å–µ—Ä—ã
- –∏ —Ç.–¥.

–§–û–†–ú–ê–¢:
**${startTimecode} - ${endTimecode}**
–í–∏–¥: –ù–î–ü
–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ: –¢–∏—Ç—Ä—ã
—Ä–µ–∂–∏—Å—Å—ë—Ä-–ø–æ—Å—Ç–∞–Ω–æ–≤—â–∏–∫
–†–û–ú–ê–ù –ò–í–ê–ù–û–í
–≥–ª–∞–≤–Ω—ã–µ –∞–≤—Ç–æ—Ä—ã
–ö–ò–†–ê –•–£–î–û–õ–ï–ô
–ê–ù–ê–°–¢–ê–°–ò–Ø –≠–ö–ê–†–ï–í–ê
[–∏ —Ç–∞–∫ –¥–∞–ª–µ–µ...]
–î–∏–∞–ª–æ–≥–∏: –ú—É–∑—ã–∫–∞

–ü–µ—Ä–µ—á–∏—Å–ª–∏ –≤—Å–µ—Ö –∫–æ–≥–æ –≤–∏–¥–∏—à—å –≤ —Ç–∏—Ç—Ä–∞—Ö.`;
}


/**
 * –°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å—Ü–µ–Ω—ã
 */
export function buildPromptForScene(
  scene: MergedScene,
  allScenes: MergedScene[],
  sceneIndex: number,
  characterRegistry: string = ''
): string {
  if (scene.type === 'opening_credits') {
    return createOpeningCreditsPrompt(
      scene.start_timecode,
      scene.end_timecode,
      scene.originalScenesCount
    );
  }
  
  if (scene.type === 'closing_credits') {
    return createClosingCreditsPrompt(
      scene.start_timecode,
      scene.end_timecode,
      scene.originalScenesCount
    );
  }
  
  // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å—Ü–µ–Ω ‚Äî –≥—Ä—É–ø–ø–æ–≤–æ–π –ø—Ä–æ–º–ø—Ç
  // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ regular —Å—Ü–µ–Ω—ã –≤ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç
  const regularScenes = allScenes
    .filter(s => s.type === 'regular')
    .map(s => ({
      start_timecode: s.start_timecode,
      end_timecode: s.end_timecode,
    }));
  
  return createMainPrompt(regularScenes, characterRegistry);
}


/**
 * –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —á–∞–Ω–∫–∞ —Å —É—á—ë—Ç–æ–º merged scenes
 */
export function createChunkPromptV2(
  scenes: MergedScene[],
  chunkIndex: number,
  totalChunks: number,
  characterRegistry: string = ''
): string {
  // –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ç–∏–ø—ã
  const openingCredits = scenes.find(s => s.type === 'opening_credits');
  const closingCredits = scenes.find(s => s.type === 'closing_credits');
  const regularScenes = scenes.filter(s => s.type === 'regular');
  
  const parts: string[] = [];
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞—Å—Ç–∞–≤–∫–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫
  if (openingCredits) {
    parts.push(createOpeningCreditsPrompt(
      openingCredits.start_timecode,
      openingCredits.end_timecode,
      openingCredits.originalScenesCount
    ));
    parts.push('\n---\n');
  }
  
  // –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω—ã
  if (regularScenes.length > 0) {
    parts.push(createMainPrompt(
      regularScenes.map(s => ({
        start_timecode: s.start_timecode,
        end_timecode: s.end_timecode,
      })),
      characterRegistry
    ));
  }
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–∏—Ç—Ä—ã ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫
  if (closingCredits) {
    parts.push('\n---\n');
    parts.push(createClosingCreditsPrompt(
      closingCredits.start_timecode,
      closingCredits.end_timecode,
      closingCredits.originalScenesCount
    ));
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞–Ω–∫–µ
  if (totalChunks > 1) {
    parts.push(`\n\n–≠—Ç–æ —á–∞—Å—Ç—å ${chunkIndex + 1} –∏–∑ ${totalChunks}.`);
  }
  
  return parts.join('\n');
}

/**
 * v3 JSON prompt for a chunk (supports merged scenes).
 * Produces ONE JSON array for all plans in the chunk (including credits plans if present).
 */
export function createChunkPromptV3Json(
  scenes: MergedScene[],
  chunkIndex: number,
  totalChunks: number,
  characterRegistry: string = ''
): string {
  const ordered = [...scenes].sort((a, b) => a.start_timestamp - b.start_timestamp);
  const boundaries = ordered.map(s => ({
    start_timecode: s.start_timecode,
    end_timecode: s.end_timecode,
  }));

  // Reuse the JSON schema instructions from createMainPromptJson
  const base = createMainPromptJson(boundaries, characterRegistry);

  const hasOpening = ordered.some(s => s.type === 'opening_credits');
  const hasClosing = ordered.some(s => s.type === 'closing_credits');

  return `${base}

–≠—Ç–æ —á–∞—Å—Ç—å ${chunkIndex + 1} –∏–∑ ${totalChunks}.
${hasOpening ? '–ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –ø–ª–∞–Ω –∑–∞—Å—Ç–∞–≤–∫–∏ ‚Äî –≤ content_summary –Ω–∞—á–Ω–∏ —Å "–ó–∞—Å—Ç–∞–≤–∫–∞." –∏ –ø–µ—Ä–µ—á–∏—Å–ª–∏ –ª–æ–≥–æ—Ç–∏–ø—ã/—Ç–∏—Ç—Ä—ã/—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.' : ''}
${hasClosing ? '\n–ï—Å–ª–∏ –≤ —Å–ø–∏—Å–∫–µ –µ—Å—Ç—å –ø–ª–∞–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ç–∏—Ç—Ä–æ–≤ ‚Äî –≤ content_summary –Ω–∞—á–Ω–∏ —Å "–¢–∏—Ç—Ä—ã." –∏ –ø–µ—Ä–µ—á–∏—Å–ª–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏/–∏–º–µ–Ω–∞ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ.' : ''}
`;
}


/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–µ—Å—Ç—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
 */
export function formatCharacterRegistryForPrompt(
  characters: Array<{ name: string; gender?: string; actor?: string }>
): string {
  if (!characters || characters.length === 0) {
    return '';
  }
  
  return characters
    .map(c => {
      let line = c.name;
      if (c.actor) line += ` (${c.actor})`;
      if (c.gender) line += ` ‚Äî ${c.gender === 'female' ? '–ñ' : '–ú'}`;
      return line;
    })
    .join('\n');
}



