export const MONTAGE_ANALYSIS_PROMPT = `🎬 ЗАДАЧА: Создать ПОЛНЫЙ монтажный лист

КРИТИЧЕСКИ ВАЖНО:
• КАЖДАЯ монтажная склейка (смена кадра) = ОТДЕЛЬНЫЙ план
• ДАЖЕ если план длится <1 секунды  
• ДАЖЕ если диалог продолжается без паузы
• Таймкоды должны идти ВСТЫК (конец плана N = начало плана N+1)

═══════════════════════════════════════════════════════════

🎯 ЧТО ТАКОЕ МОНТАЖНАЯ СКЛЕЙКА:

СКЛЕЙКА = момент, когда меняется:
✓ Ракурс камеры (Кр. → Ср. → Общ.)
✓ Персонаж в кадре (Тома → Галя → Тома)
✓ Локация (салон → ресторан → улица)
✓ Крупность плана (Деталь → Кр. → Ср.)

КАЖДАЯ такая смена = НОВЫЙ ПЛАН!

ПРИМЕР ИЗ РЕАЛЬНОГО МОНТАЖА:
**План 10:** 00:01:22:09 - 00:01:23:14 | Кр. | Тома говорит в кадре | ТОМА вы знаете,
**План 11:** 00:01:23:14 - 00:01:24:12 | Кр. | Тома моет руки | ТОМА у нас
**План 12:** 00:01:24:12 - 00:01:29:20 | Кр. НДП | Тома в кадре | ТОМА такая проблема? ГАЛЯ Проблема?
**План 13:** 00:01:29:20 - 00:01:30:19 | Кр. | Галя хватается за живот | (без диалога)
**План 14:** 00:01:30:19 - 00:01:33:08 | Кр. НДП | Галя в кадре | ГАЛЯ Вы имеете ввиду мою беременность?

ВИДИМ:
• 5 планов за 11 секунд
• Диалог разбит на части по склейкам
• Каждая склейка = отдельный план
• План 13 без диалога (только действие)
• Таймкоды идут ВСТЫК: ...23:14 → 23:14...24:12 → 24:12...29:20 → 29:20...

═══════════════════════════════════════════════════════════

🚨 ТАЙМКОДЫ - АБСОЛЮТНОЕ ТРЕБОВАНИЕ:

**ПРАВИЛО СТЫКОВКИ:**
Конечный таймкод плана N = Начальный таймкод плана N+1

✅ ПРАВИЛЬНО (стыкуются):
**00:01:22:09 - 00:01:23:14**
**00:01:23:14 - 00:01:24:12**  ← начало = конец предыдущего
**00:01:24:12 - 00:01:29:20**

❌ НЕПРАВИЛЬНО (разрывы):
**00:01:22:09 - 00:01:23:14**
**00:01:23:15 - 00:01:24:12**  ← пропущен 1 кадр!
**00:01:24:13 - 00:01:29:20**  ← еще пропуск!

**Откуда брать таймкоды:**
• В видео есть ВСТРОЕННАЯ ПЛАШКА с таймкодом
• ЧИТАЙ точные цифры с плашки
• Формат: ЧЧ:ММ:СС:КК (часы:минуты:секунды:КАДРЫ)
• Обычно 24 fps (кадры 00-23)

**Как определить момент склейки:**
1. Смотри видео покадрово
2. Засекай ТОЧНЫЙ кадр где происходит смена
3. Этот таймкод = конец текущего плана И начало следующего

═══════════════════════════════════════════════════════════

💬 ДИАЛОГИ - РАЗБИЕНИЕ ПО ПЛАНАМ:

**КЛЮЧЕВОЕ ПРАВИЛО:**
Если диалог идет через несколько склеек - РАЗБИВАЙ его на части!

**Пример - один диалог, разбитый на 3 плана:**

**План 10:** 00:01:22:09 - 00:01:23:14
*   **Диалоги/Музыка:**
    ТОМА
    вы знаете,

**План 11:** 00:01:23:14 - 00:01:24:12  
*   **Диалоги/Музыка:**
    ТОМА
    у нас

**План 12:** 00:01:24:12 - 00:01:29:20
*   **Диалоги/Музыка:**
    ТОМА
    такая проблема?
    ГАЛЯ
    Проблема?

**ФОРМАТ ДИАЛОГОВ:**

ИМЯ ЗАГЛАВНЫМИ (отдельная строка)
текст реплики

БЕЗ двоеточия, скобок, кавычек!

✅ ПРАВИЛЬНО:
ТОМА
Проходите. Присаживайтесь

❌ НЕПРАВИЛЬНО:
ТОМА: Проходите
(Тома) Проходите

**Голос за кадром:**
• ГЗ или ЗК - после имени  
• Пример: "ГАЛЯ ЗК" или "ГАЛЯ ГЗ"

**Имена персонажей:**
• После показа в титрах - используй имя
• До титров: (Мужчина), (Женщина)
• В описании: "Тома идет", "Галя говорит"

═══════════════════════════════════════════════════════════

🎭 ЗАСТАВКА - ЕДИНСТВЕННОЕ ИСКЛЮЧЕНИЕ:

Заставка (opening credits) = ОДИН большой план (обычно 30-90 секунд)

**Реальный пример:**

План 1: 00:00:00:00 - 00:00:04:09 | НДП | Логотип. Телекомпания Партнер. | Музыка
План 2: 00:00:04:09 - 00:01:06:13 | Ср. НДП | Заставка (62 секунды!) | Музыка  
План 3: 00:01:06:13 - 00:01:09:09 | Ср. НДП | Начало истории | ТОМА Проходите...

**Заставка включает все подряд:**
- Логотипы компаний
- Титры с именами актёров
- Название сериала
- Музыку
- Короткие визуальные фрагменты (девушки крутятся, целуются и т.д.)

ВСЕ это описывай в ОДНОМ плане!

**После заставки:**
Каждая склейка = отдельный план (обычное правило возвращается)

═══════════════════════════════════════════════════════════

💬 ДЛИННЫЕ ДИАЛОГИ БЕЗ СКЛЕЕК:

Если диалог идет БЕЗ смены плана - весь диалог в одном плане!

**Реальный пример - план 54 (длинный диалог в одном плане):**

Таймкод: 00:03:10:11 - 00:03:33:02 (22 секунды, один план!)
План: Ср.
Содержание: Галя ловит в зале напарницу, спрашивает ее, записывает в блокнот.
Диалоги/Музыка:
    ГАЛЯ
    Тань, Тань. Танька скажи пожалуйста, а что такое почеревок? Я опять забыла
    ТАНЯ
    у тебя что голова сдурела что ли? Я тебе сколько раз говорила.
    ГАЛЯ
    ну у меня с твоим украинским ну никак.
    ТАНЯ
    он такой же твой, как и мой.
    ГАЛЯ
    ну там хоть была. А я из Балабанова своего не выезжала никогда.
    ТАНЯ
    вспомни ты теперь в Москве. Тут мозги надо иметь. Запоминай. Почеревок
    ГАЛЯ
    почеревок
    ТАНЯ
    это мясо с салом копченым
    ГАЛЯ
    ага.
    ТАНЯ
    ой глянь-ка чернявый-то как на тебя, прям

КОГДА длинный диалог в одном плане:
• Камера НЕ меняется (один непрерывный кадр)
• Все реплики подряд
• Каждое имя на новой строке

═══════════════════════════════════════════════════════════

📝 ТИТРЫ И НАДПИСИ:

**В содержании после слова "Титр" - КАЖДЫЙ титр на НОВОЙ строке:**

✅ Правильно:
Тома идет по салону.
Титр
Галина – Полина Нечитайло.
Титр
Юсеф – Олег Чудницов-Хартулари

❌ Неправильно (всё в кучу):
Титр МЕНЕДЖЕР САЛОНА КРАСОТЫ ТАТЬЯНА ЕЛЕНА ЧЕКМАЗОВА. РЕЖИССЕР-ПОСТАНОВЩИК АЛЕКСАНДРА ЕРОФЕЕВА.

**Если есть надписи на экране:** добавь "НДП" к типу плана → "Кр. НДП"

═══════════════════════════════════════════════════════════

🎵 МУЗЫКА И ЗВУКИ:

• В 90% случаев: "Музыка"
• Если важно: "Народная музыка", "Напряженная музыка"
• Ключевые звуки: "Шум воды", "Звон", "Смех"
• НЕ описывай подробно!

✅ Правильно: Музыка
❌ Неправильно: Музыка: Начинается оркестровая, энергичная, слегка мистическая музыка с нарастающими струнными...

═══════════════════════════════════════════════════════════

📝 ОПИСАНИЯ СОДЕРЖАНИЯ:

• КРАТКО: 1-2 предложения (максимум 3)
• Что происходит, кто в кадре, основное действие
• БЕЗ лишних деталей ("молодая", "светлый современный")

✅ Правильно:
Тома идет по салону, оборачивается.
Галя садится на кушетку.
Юсеф сидит за столом, смотрит в меню.

❌ Неправильно:
Тома, молодая женщина в белом халате, заходит в светлый современный салон красоты. Она проходит мимо ширмы, на заднем плане виден вход.

═══════════════════════════════════════════════════════════

📖 ГЛОССАРИЙ:

**Типы планов:**
• Дальний - человек очень маленький в кадре
• Общий (Общ.) - человек в полный рост
• Средний (Ср.) - по колени или по пояс
• Крупный (Кр.) - голова и плечи
• Деталь - часть лица или небольшой предмет

**Комбинированные типы:**
• Ср. НДП - Средний план с надписями на экране
• Кр. НДП - Крупный план с титрами на экране
• НДП - только надписи (без персонажей)

**Сокращения:**
ЗТМ - затемнение
НДП - надписи на экране
ГЗК - голос за кадром
ПНР - панорама
Рапид - ускоренная съёмка

═══════════════════════════════════════════════════════════

🎬 АЛГОРИТМ РАБОТЫ:

**ШАГ 1: Найди все склейки**
Смотри видео, отмечай КАЖДЫЙ момент смены кадра

**ШАГ 2: Для каждой склейки:**
1. Засекай ТОЧНЫЙ таймкод начала и конца с плашки
2. Определи тип плана (Кр., Ср., Общ. и т.д.)
3. Опиши что в кадре (кратко!)
4. Укажи диалоги/музыку ЭТОГО плана

**ШАГ 3: Проверь стыковку**
Конец плана N = Начало плана N+1 (БЕЗ РАЗРЫВОВ!)

**ШАГ 4: Проверь диалоги**
• Если диалог длинный и идет через несколько планов - разбей его
• В каждом плане - только та часть, которая звучит в нём
• Если в плане нет диалога - укажи "Музыка" или звуки

═══════════════════════════════════════════════════════════

⚠️ ЧАСТЫЕ ОШИБКИ - НЕ ДОПУСКАЙ:

❌ **Объединение нескольких склеек в один план**
Плохо: 00:01:22:09 - 00:01:33:08 (это 3-5 склеек, не один план!)

❌ **Разрывы в таймкодах**
Плохо: План заканчивается 00:01:23:14, следующий начинается 00:01:24:00 (пропуск!)
Правильно: План заканчивается 00:01:23:14, следующий начинается 00:01:23:14 (встык!)

❌ **Потеря части диалога**
Реальность: ТОМА вы знаете, у нас такая проблема?
Ошибка: ТОМА такая проблема? (потеряно начало!)

❌ **Пропуск планов без диалога**
Ошибка: пропустил план, потому что там только "Галя хватается за живот"
Правильно: КАЖДАЯ склейка = план, даже без диалога!

❌ **Неправильный формат имени**
Ошибка: ТОМА: Проходите
Правильно: ТОМА (на отдельной строке)
           Проходите (на следующей строке)

═══════════════════════════════════════════════════════════

📊 САМОПРОВЕРКА:

После завершения проверь:
• ✓ Таймкоды идут встык (без разрывов)
• ✓ Нет пропущенных склеек
• ✓ Диалоги полные (не потеряны части реплик)
• ✓ Формат имён правильный (без двоеточий)
• ✓ ~15-25 планов в минуту (для динамичных сцен)

═══════════════════════════════════════════════════════════

ФОРМАТ ОТВЕТА:

**ЧЧ:ММ:СС:КК - ЧЧ:ММ:СС:КК**
*   **План:** [Тип + НДП если есть надписи]
*   **Содержание:** [Краткое описание. Титры на новых строках после слова "Титр"]
*   **Диалоги/Музыка:** [
    ИМЯ ЗАГЛАВНЫМИ
    текст реплики
    
    ИЛИ ГЗК: текст
    ИЛИ Музыка
    ]

═══════════════════════════════════════════════════════════

ПРИМЕРЫ ИЗ РЕАЛЬНОГО МОНТАЖА:

**Пример 1: Диалог разбит на несколько планов**

**00:01:22:09 - 00:01:23:14**
*   **План:** Кр.
*   **Содержание:** Тома говорит в кадре
*   **Диалоги/Музыка:**
    ТОМА
    вы знаете,

**00:01:23:14 - 00:01:24:12**
*   **План:** Кр.
*   **Содержание:** Тома моет руки
*   **Диалоги/Музыка:**
    ТОМА
    у нас

**00:01:24:12 - 00:01:29:20**
*   **План:** Кр. НДП
*   **Содержание:** Тома в кадре. Камера двигается в сторону, переходит на клиентку.
    Титр
    жены Анна Татренко, Инна Михайлова, Кристина Рубан, Анна Мешкова, Оксана Горбутовская
*   **Диалоги/Музыка:**
    ТОМА
    такая проблема?
    ГАЛЯ
    Проблема?

**00:01:29:20 - 00:01:30:19**
*   **План:** Кр.
*   **Содержание:** Галя хватается руками за живот
*   **Диалоги/Музыка:** Музыка

**00:01:30:19 - 00:01:33:08**
*   **План:** Кр. НДП
*   **Содержание:** Галя в кадре.
    Титр
    дочери Кристина Болевудзе, Марина Начкебия, Полина Горшенина, клиентка салона Элона Казакова
*   **Диалоги/Музыка:**
    ГАЛЯ
    Вы имеете ввиду мою беременность?

**Пример 2: Голос за кадром (ГЗК/ЗК)**

**00:07:17:18 - 00:07:19:15**
*   **План:** Общ.
*   **Содержание:** Галя танцует в ресторане перед Юсефом восточные танцы.
*   **Диалоги/Музыка:**
    ГАЛЯ ГЗ
    деньги у него

**00:07:19:15 - 00:07:20:20**
*   **План:** Кр.
*   **Содержание:** Юсеф в кадре, смотрит на танцы Галины
*   **Диалоги/Музыка:**
    ГАЛЯ ЗК
    всегда были. Стал он

**Пример 3: Серия коротких планов (монтажная "восьмерка")**

**00:42:48:22 - 00:42:49:21**
*   **План:** Кр.
*   **Содержание:** Белла смотрит на Марину.
*   **Диалоги/Музыка:** Музыка

**00:42:49:21 - 00:42:50:20**
*   **План:** Кр.
*   **Содержание:** Марина смотрит на Беллу.
*   **Диалоги/Музыка:** Музыка

**00:42:50:20 - 00:42:51:22**
*   **План:** Кр.
*   **Содержание:** Белла смотрит на Марину.
*   **Диалоги/Музыка:** Музыка

(Планы по ~1 секунде каждый - все равно ОТДЕЛЬНЫЕ планы!)`;

export function createChunkPrompt(
  chunkIndex: number,
  startTimecode: string,
  endTimecode: string,
  totalChunks: number
): string {
  if (totalChunks > 1) {
    return `${MONTAGE_ANALYSIS_PROMPT}

═══════════════════════════════════════════════════════════

🚨 ТЫ ПОЛУЧИЛ ФРАГМЕНТ ВИДЕО:

Часть ${chunkIndex + 1} из ${totalChunks}. Это НЕ весь фильм!

🎯 ИСПОЛЬЗУЙ ТАЙМКОДЫ ИЗ ПЛАШКИ В ВИДЕО:
• Смотри на встроенный таймкод в каждом плане
• Используй ТОЧНЫЙ таймкод который там показан (не выдумывай!)

Примерный диапазон этого фрагмента: ${startTimecode} - ${endTimecode}

✅ Правильно (из плашки): **00:19:35:05 - 00:19:38:12**
❌ Неправильно (выдуманный): **00:00:35:05 - 00:00:38:12**

Анализируй ВСЕ планы до конца видео. Останавливайся только когда видео закончится!`;
  }
  
  return MONTAGE_ANALYSIS_PROMPT;
}
