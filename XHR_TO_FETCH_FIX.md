# ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: XHR ‚Üí Fetch API

## üîç –ß–¢–û –ù–ê–®–õ–ò:

### Timeline –∏–∑ git:
- **17.11.2025** (commit a54a707): –î–æ–±–∞–≤–∏–ª–∏ direct Supabase upload —á–µ—Ä–µ–∑ XHR
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ **87 MB —Ñ–∞–π–ª–∞—Ö** - —Ä–∞–±–æ—Ç–∞–ª–æ ‚úÖ
- **18.11.2025**: –í—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ –∏–¥–µ–∞–ª—å–Ω–æ
- **20.11.2025**: **138 MB —Ñ–∞–π–ª—ã –ø–∞–¥–∞—é—Ç** —Å 502 ‚ùå

### –¢–µ—Å—Ç—ã —Å–µ–≥–æ–¥–Ω—è:
- Server SDK upload (100 MB) ‚Üí ‚úÖ SUCCESS in 10s
- Browser XHR upload (138 MB) ‚Üí ‚ùå 502 CORS error (–≤—Å–µ 3 retry)

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê: XHR + Signed URLs + Large Files

**XMLHttpRequest –∏–º–µ–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–æ–ª—å—à–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏:**
- –ü–ª–æ—Ö–æ handling timeout'–æ–≤
- –ù–µ–Ω–∞–¥—ë–∂–µ–Ω –¥–ª—è —Ñ–∞–π–ª–æ–≤ >100 MB
- –ü—Ä–æ–±–ª–µ–º—ã —Å CORS –¥–ª—è –±–æ–ª—å—à–∏—Ö body
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–π API (legacy)

**Fetch API:**
- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç
- –õ—É—á—à–µ handling –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –¥–ª—è long-running requests
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ XHR

---

## ‚úÖ –ß–¢–û –ò–ó–ú–ï–ù–ï–ù–û:

### –í `components/UploadModalLong.tsx`:

**–ë—ã–ª–æ (XHR):**
```typescript
const xhr = new XMLHttpRequest();
xhr.timeout = 600000;
xhr.open('PUT', uploadUrl);
xhr.setRequestHeader('Content-Type', file.type);
xhr.send(file);
```

**–°—Ç–∞–ª–æ (Fetch):**
```typescript
const response = await fetch(uploadUrl, {
  method: 'PUT',
  headers: {
    'Content-Type': file.type,
  },
  body: file,
});

if (!response.ok) {
  throw new Error(`Upload failed: ${response.status}`);
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–µ–Ω –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –õ—É—á—à–µ handling timeout'–æ–≤
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å retry –ª–æ–≥–∏–∫–æ–π

**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:**
- ‚ö†Ô∏è –ù–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ progress tracking (fetch –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç progress events)
- –ù–æ: –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–æ –≤—Ä–µ–º—è retry

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### 1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É:
```
Cmd + Shift + R
```

### 2. –ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ 138 MB:
```
–°–õ–ï–ü–ê–Ø_–¶–µ–Ω–∞ —Å—á–∞—Å—Ç—å—è_–û—Ç—Ä–∞–∂–µ–Ω–∏–µ —Å—É–¥—å–±—ã.mp4
```

### 3. –°–ª–µ–¥–∏ –∑–∞ console:
```
Upload attempt 1/3...
‚úÖ File uploaded successfully on attempt 1
```

–ò–ª–∏ –µ—Å–ª–∏ —É–ø–∞–¥—ë—Ç:
```
‚ùå Attempt 1/3 failed
‚è≥ Waiting 3000ms...
Upload attempt 2/3...
```

---

## üìä –ü–û–ß–ï–ú–£ –≠–¢–û –î–û–õ–ñ–ù–û –ü–û–ú–û–ß–¨:

### Fetch vs XHR –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:

| –ê—Å–ø–µ–∫—Ç | XHR (—Å—Ç–∞—Ä—ã–π) | Fetch (–Ω–æ–≤—ã–π) |
|--------|--------------|---------------|
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã >100 MB | ‚úÖ –õ—É—á—à–µ |
| **Timeout handling** | ‚ö†Ô∏è –ù–µ–Ω–∞–¥—ë–∂–Ω–æ | ‚úÖ –ù–∞–¥—ë–∂–Ω–æ |
| **CORS** | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã | ‚úÖ –õ—É—á—à–µ |
| **–°—Ç–∞–Ω–¥–∞—Ä—Ç** | Legacy (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π) | Modern (2015+) |
| **Progress** | ‚úÖ –ï—Å—Ç—å | ‚ùå –ù–µ—Ç (–Ω–æ –º–æ–∂–Ω–æ —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å) |

---

## üéØ –ï–°–õ–ò FETCH –¢–û–ñ–ï –ù–ï –ü–û–ú–û–ñ–ï–¢:

–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ—á–Ω–æ –≤ **Signed Upload URLs —Å –ª–∏–º–∏—Ç–æ–º ~100 MB**.

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
1. **Chunked upload –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞** (—Ä–∞–∑–±–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 50 MB)
2. **–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TUS protocol** (resumable uploads)
3. **–ò–ª–∏ –ø–∏—Å–∞—Ç—å –≤ Supabase Support** —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç

–ù–æ —Å–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º Fetch! üöÄ

---

**–ü–û–ü–†–û–ë–£–ô –°–ï–ô–ß–ê–°!** Fetch –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ XHR!



