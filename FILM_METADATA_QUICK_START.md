# Быстрый старт: Форма деталей фильма

## Что было добавлено

✅ **Двухшаговая загрузка видео:**
1. Форма "Данные фильма" (с возможностью пропустить)
2. Загрузка видео файла

✅ **Автозаполнение документов:**
- Данные из формы автоматически подставляются в Excel
- Данные из формы автоматически подставляются в Word документ

## Как применить изменения

### 1. Обновить базу данных

Откройте [Supabase Dashboard](https://supabase.com/dashboard) → SQL Editor и выполните:

```sql
-- Добавить колонку для метаданных фильма
ALTER TABLE videos ADD COLUMN IF NOT EXISTS film_metadata_json JSONB;

-- Добавить индекс для быстрого поиска
CREATE INDEX IF NOT EXISTS idx_videos_film_metadata ON videos USING GIN (film_metadata_json);

-- Добавить комментарий
COMMENT ON COLUMN videos.film_metadata_json IS 'Stores film metadata including producer, director, year, country, etc.';
```

### 2. Перезапустить приложение

```bash
npm run dev
```

## Как это работает

### Для пользователя:

1. Нажимает "Новый лист"
2. Видит форму с полями:
   - Фирма-производитель
   - Год выпуска
   - Страна производства
   - Автор сценария
   - Режиссер-постановщик
   - Правообладатель
   - Продолжительность
   - Количество серий
   - Формат кадра
   - Цветной/черно-белый
   - Носитель информации
   - Языки (оригинал, надписи, фонограмма)

3. Выбирает один из вариантов:
   - ✅ **"Продолжить"** - заполняет поля и продолжает к загрузке видео
   - ⏭️ **"Пропустить"** - сразу переходит к загрузке видео без заполнения
   - ❌ **"Отмена"** - закрывает форму

4. После загрузки видео - экспорт Excel/Word содержит все заполненные данные!

## Файлы которые были изменены

### Новые файлы:
- `components/FilmDetailsModal.tsx` - форма деталей
- `components/TwoStepUploadModal.tsx` - обертка для двух шагов
- `add-film-metadata-column.sql` - миграция БД
- `FILM_METADATA_SETUP.md` - полная документация

### Измененные файлы:
- `types/index.ts` - добавлен интерфейс `FilmMetadata`
- `components/UploadModal.tsx` - добавлена поддержка метаданных
- `components/DashboardClient.tsx` - использует новую двухшаговую форму
- `app/api/upload/route.ts` - сохраняет метаданные в БД
- `app/api/export-doc/[videoId]/route.ts` - подставляет данные в Word
- `app/api/export/[videoId]/route.ts` - подставляет данные в Excel

## Проверка работы

1. Откройте дашборд
2. Нажмите "Новый лист"
3. Должна открыться форма "Данные фильма"
4. Заполните несколько полей
5. Нажмите "Продолжить"
6. Загрузите видео
7. После обработки - скачайте Excel/Word
8. Проверьте, что данные из формы появились в документах

## Откат (если что-то пошло не так)

```sql
DROP INDEX IF EXISTS idx_videos_film_metadata;
ALTER TABLE videos DROP COLUMN IF EXISTS film_metadata_json;
```

Затем откатите изменения в git:
```bash
git checkout -- .
```

