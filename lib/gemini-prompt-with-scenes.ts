/**
 * Prompt for Gemini when FFmpeg has already detected scene cuts
 * V3: Give Gemini EXACT list of timecodes - no more guessing!
 */
export function createPromptWithDetectedScenes(
  scenes: Array<{ start_timecode: string; end_timecode: string }>,
  chunkIndex: number,
  totalChunks: number
): string {
  // V3: Give Gemini the FULL LIST of scenes to describe
  const sceneList = scenes
    .map((scene, i) => `${i + 1}. **${scene.start_timecode} - ${scene.end_timecode}**`)
    .join('\n');

  return `🎬 ЗАДАЧА: Опиши ВСЕ ${scenes.length} планов из списка ниже

═══════════════════════════════════════════════════════════

📋 ПЛАНЫ ДЛЯ ОПИСАНИЯ (таймкоды УЖЕ ОПРЕДЕЛЕНЫ, НЕ МЕНЯЙ ИХ!):

${sceneList}

═══════════════════════════════════════════════════════════

📝 ДЛЯ КАЖДОГО ПЛАНА УКАЖИ:

1. **Тип плана:** Кр., Ср., Общ., Деталь, Дальний
   - Добавь "НДП" если есть титры: "Кр. НДП"
   
2. **Содержание (1-2 предложения):**
   - Кто в кадре, что делает
   - Если титры → каждый после слова "Титр" на новой строке
   
3. **Диалоги/Музыка:**
   - Диалог: ИМЯ (заглавными, на отдельной строке), затем текст
   - Голос за кадром: ИМЯ ЗК или ИМЯ ГЗ
   - Нет диалога: "Музыка"

═══════════════════════════════════════════════════════════

🎭 ИМЕНА ПЕРСОНАЖЕЙ - ОЧЕНЬ ВАЖНО!

1. **ЧИТАЙ ТИТРЫ НА ЭКРАНЕ!** В них указано кто есть кто:
   - Формат титра: "Имя персонажа – Имя актёра"
   - Пример: "Галина – Полина Нечитайло" → персонаж зовут ГАЛИНА (или ГАЛЯ)
   
2. **ЗАПОМИНАЙ имена из титров** и используй их дальше!
   - Увидел титр "Тома – Наталья Бабенко" → эту женщину зовут ТОМА
   - Увидел титр "Юсеф – Олег Чудницов" → этого мужчину зовут ЮСЕФ

3. **НЕ ПИШИ общие описания** когда знаешь имя!
   ❌ ПЛОХО: "БЛОНДИНКА", "МУЖЧИНА", "ЖЕНЩИНА В ПЛАТЬЕ"
   ✅ ХОРОШО: "ГАЛЯ", "ЮСЕФ", "ТОМА" (имена из титров)

4. **До появления титров** - используй описание:
   - "МУЖЧИНА", "ЖЕНЩИНА", "ДЕВУШКА В КРАСНОМ"
   - После титра - переключайся на имя!

═══════════════════════════════════════════════════════════

⚠️ КРИТИЧЕСКИ ВАЖНО:

1. Опиши ВСЕ ${scenes.length} планов - НЕ пропускай ни одного!
2. Используй ТОЧНО те таймкоды что в списке - НЕ меняй их!
3. Заставка/титры = тоже планы, описывай их!
4. Короткие планы (<1 сек) = тоже описывай!
5. ЧИТАЙ ТИТРЫ и используй имена персонажей!

═══════════════════════════════════════════════════════════

✅ ФОРМАТ ОТВЕТА (для КАЖДОГО плана из списка):

**ЧЧ:ММ:СС:КК - ЧЧ:ММ:СС:КК**
*   **План:** [Тип]
*   **Содержание:** [Описание]
*   **Диалоги/Музыка:** [Диалоги или Музыка]

═══════════════════════════════════════════════════════════

📖 ПРИМЕРЫ:

**00:00:06:04 - 00:00:08:05**
*   **План:** Кр. НДП
*   **Содержание:** Девушка смотрит в камеру. Титр Шурочка - Татьяна Рыбинец
*   **Диалоги/Музыка:** Музыка

**00:04:07:14 - 00:04:11:01**
*   **План:** Ср.
*   **Содержание:** Галя с маской на лице, Тома рядом.
*   **Диалоги/Музыка:**
    ГАЛЯ
    Ммм, ну, это такой, веселый был, симпатичный

**00:07:17:18 - 00:07:19:15**
*   **План:** Общ.
*   **Содержание:** Галя танцует в ресторане
*   **Диалоги/Музыка:**
    ГАЛЯ ЗК
    деньги у него всегда были

═══════════════════════════════════════════════════════════

🚨 НАЧИНАЙ С ПЕРВОГО ПЛАНА И ИДИ ПО ПОРЯДКУ ДО ПОСЛЕДНЕГО!
${totalChunks > 1 ? `\nЭто часть ${chunkIndex + 1} из ${totalChunks}. Опиши все ${scenes.length} планов этой части!` : ''}`;
}

/**
 * OLD VERSION - kept for reference
 * This approach (giving full list) overloads Gemini
 */
export function createPromptWithDetectedScenesOLD(
  scenes: Array<{ start_timecode: string; end_timecode: string }>,
  chunkIndex: number,
  totalChunks: number
): string {
  const sceneList = scenes
    .map((scene, i) => `${i + 1}. ${scene.start_timecode} - ${scene.end_timecode}`)
    .join('\n');

  return `📋 СПИСОК ПЛАНОВ С ТОЧНЫМИ ТАЙМКОДАМИ:

${sceneList}

Всего планов для анализа: ${scenes.length}

═══════════════════════════════════════════════════════════

📝 ДЛЯ КАЖДОГО ПЛАНА УКАЖИ:

1. **Тип плана:**
   - Дальний, Общ., Ср., Кр., Деталь
   - Добавь "НДП" если есть титры на экране
   - Пример: "Кр. НДП", "Ср.", "Общ."

2. **Содержание (1-2 предложения):**
   - Кто в кадре, что делает
   - Если есть титры - каждый на новой строке после слова "Титр"
   - Кратко и по делу!

3. **Диалоги/Музыка:**
   - Если есть диалог: ИМЯ (заглавными, на отдельной строке), затем текст
   - Если голос за кадром: ИМЯ ГЗ или ИМЯ ЗК
   - Если нет диалога: "Музыка" или "Музыка (народная)" и т.д.

═══════════════════════════════════════════════════════════

✅ ПРАВИЛЬНЫЙ ФОРМАТ ДИАЛОГА:

**Диалог в кадре:**
ТОМА
Проходите. Присаживайтесь

**Голос за кадром:**
ГАЛЯ ЗК
деньги у него всегда были

**Несколько реплик в одном плане:**
ТОМА
такая проблема?
ГАЛЯ
Проблема?

❌ НЕПРАВИЛЬНО:
ТОМА: Проходите
(Тома) Проходите

═══════════════════════════════════════════════════════════

📖 ТИПЫ ПЛАНОВ:

• **Дальний** - человек очень маленький в кадре
• **Общ.** - человек в полный рост
• **Ср.** - по колени/пояс  
• **Кр.** - голова и плечи
• **Деталь** - часть лица или предмет

**С титрами:**
• **Кр. НДП** - крупный план + надписи на экране
• **Ср. НДП** - средний план + титры

**Другие:**
• **ЗТМ** - затемнение

═══════════════════════════════════════════════════════════

📝 ПРИМЕРЫ:

**Пример 1: План с диалогом**

**00:01:06:13 - 00:01:09:09**
*   **План:** Ср. НДП
*   **Содержание:** Тома идет по салону в белой форме, оборачивается.
    Титр
    Галина – Полина Нечитайло.
    Титр
    Юсеф – Олег Чудницов-Хартулари
*   **Диалоги/Музыка:**
    ТОМА
    Проходите. Присаживайтесь

**Пример 2: План без диалога**

**00:01:29:20 - 00:01:30:19**
*   **План:** Кр.
*   **Содержание:** Галя хватается руками за живот
*   **Диалоги/Музыка:** Музыка

**Пример 3: Голос за кадром**

**00:07:17:18 - 00:07:19:15**
*   **План:** Общ.
*   **Содержание:** Галя танцует в ресторане перед Юсефом
*   **Диалоги/Музыка:**
    ГАЛЯ ГЗ
    деньги у него

**Пример 4: Длинный диалог**

**00:03:10:11 - 00:03:33:02**
*   **План:** Ср.
*   **Содержание:** Галя спрашивает Таню, Таня отвечает, Галя записывает в блокнот
*   **Диалоги/Музыка:**
    ГАЛЯ
    Тань, скажи пожалуйста, что такое почеревок?
    ТАНЯ
    у тебя что голова сдурела что ли?
    ГАЛЯ
    ну у меня с украинским никак
    ТАНЯ
    это мясо с салом копченым
    ГАЛЯ
    ага

═══════════════════════════════════════════════════════════

🎯 ТВОЯ ЗАДАЧА:

Пройдись по КАЖДОМУ плану из списка выше и опиши:
- Тип плана (Кр., Ср., Общ.)
- Содержание (кратко!)
- Диалоги или Музыка

НЕ меняй таймкоды! Они уже точные!

═══════════════════════════════════════════════════════════

ФОРМАТ ОТВЕТА:

**ЧЧ:ММ:СС:КК - ЧЧ:ММ:СС:КК**
*   **План:** [Тип]
*   **Содержание:** [Описание]
*   **Диалоги/Музыка:** [Диалоги или Музыка]

(используй точные таймкоды из списка выше!)

${totalChunks > 1 ? `\n🚨 ВАЖНО: Это часть ${chunkIndex + 1} из ${totalChunks}\nОписывай ВСЕ планы из списка до конца!` : ''}`;
}

/**
 * Fallback prompt when scene detection is not available
 * (Same as current behavior)
 */
export function createPromptWithoutScenes(
  startTimecode: string,
  endTimecode: string,
  chunkIndex: number,
  totalChunks: number
): string {
  // This will use the existing prompt from gemini-prompt.ts
  return `ИСПОЛЬЗУЙ ПРОМПТ ИЗ gemini-prompt.ts
  
Диапазон чанка: ${startTimecode} - ${endTimecode}
Часть ${chunkIndex + 1} из ${totalChunks}`;
}




