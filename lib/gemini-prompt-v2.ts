export const MONTAGE_ANALYSIS_PROMPT_V2 = `🎬 ЗАДАЧА: Создать ПОЛНЫЙ монтажный лист

КРИТИЧЕСКИ ВАЖНО:
• КАЖДАЯ монтажная склейка (смена кадра) = ОТДЕЛЬНЫЙ план
• ДАЖЕ если план длится <1 секунды
• ДАЖЕ если диалог продолжается без паузы
• Таймкоды должны идти ВСТЫК (конец плана N = начало плана N+1)

═══════════════════════════════════════════════════════════

🎯 ЧТО ТАКОЕ МОНТАЖНАЯ СКЛЕЙКА:

СКЛЕЙКА = момент, когда меняется:
✓ Ракурс камеры (Кр. → Ср. → Общ.)
✓ Персонаж в кадре (Тома → Галя → Тома)
✓ Локация (салон → ресторан → улица)
✓ Крупность плана (Деталь → Кр. → Ср.)

КАЖДАЯ такая смена = НОВЫЙ ПЛАН!

ПРИМЕР ИЗ РЕАЛЬНОГО МОНТАЖА:
**План 10:** 00:01:22:09 - 00:01:23:14 | Кр. | Тома говорит в кадре | ТОМА вы знаете,
**План 11:** 00:01:23:14 - 00:01:24:12 | Кр. | Тома моет руки | ТОМА у нас
**План 12:** 00:01:24:12 - 00:01:29:20 | Кр. НДП | Тома в кадре, камера переходит на клиентку | ТОМА такая проблема? ГАЛЯ Проблема?
**План 13:** 00:01:29:20 - 00:01:30:19 | Кр. | Галя хватается за живот | (без диалога)
**План 14:** 00:01:30:19 - 00:01:33:08 | Кр. НДП | Галя в кадре, титры | ГАЛЯ Вы имеете ввиду мою беременность?

ВИДИМ:
• 5 планов за 11 секунд
• Диалог разбит на части
• Каждая склейка = отдельный план
• План 13 без диалога (только действие)
• Таймкоды идут встык: ...23:14 → 23:14...24:12 → 24:12...29:20 → 29:20...

═══════════════════════════════════════════════════════════

🚨 ТАЙМКОДЫ - АБСОЛЮТНОЕ ТРЕБОВАНИЕ:

**ПРАВИЛО СТЫКОВКИ:**
Конечный таймкод плана N = Начальный таймкод плана N+1

✅ ПРАВИЛЬНО (стыкуются):
**00:01:22:09 - 00:01:23:14**
**00:01:23:14 - 00:01:24:12**  ← начало = конец предыдущего
**00:01:24:12 - 00:01:29:20**

❌ НЕПРАВИЛЬНО (разрывы):
**00:01:22:09 - 00:01:23:14**
**00:01:23:15 - 00:01:24:12**  ← пропущен 1 кадр!
**00:01:24:13 - 00:01:29:20**  ← еще один пропуск!

**Откуда брать таймкоды:**
• В видео есть ВСТРОЕННАЯ ПЛАШКА с таймкодом
• ЧИТАЙ точные цифры с плашки
• Формат: ЧЧ:ММ:СС:КК (часы:минуты:секунды:КАДРЫ)
• Обычно 24 fps (кадры 00-23)

**Как определить момент склейки:**
1. Смотри видео покадрово
2. Засекай ТОЧНЫЙ кадр где происходит смена
3. Этот таймкод = конец текущего плана И начало следующего

═══════════════════════════════════════════════════════════

💬 ДИАЛОГИ - РАЗБИЕНИЕ ПО ПЛАНАМ:

**КЛЮЧЕВОЕ ПРАВИЛО:**
Если диалог идет через несколько склеек - РАЗБИВАЙ его на части!

**Пример - реальный монтаж:**

План 54: 00:03:10:11 - 00:03:33:02
ГАЛЯ
Тань, Тань. Танька скажи пожалуйста, а что такое почеревок? Я опять забыла
ТАНЯ
у тебя что голова сдурела что ли? Я тебе сколько раз говорила.
ГАЛЯ
ну у меня с твоим украинским ну никак.
...весь длинный диалог...

План 55: 00:03:33:02 - 00:03:34:10
ТАНЯ
глазами съел. Аж облизывается

План 56: 00:03:34:10 - 00:03:41:13
ГАЛЯ
какой молодой что ли? Они там все чернявенькие.

**ВИДИМ:** 
• Один разговор разбит на 3+ плана
• Каждый план = своя склейка/ракурс
• Диалог продолжается, но планы меняются

**ТВОЯ ЗАДАЧА:**
Для каждого плана укажи ТУ ЧАСТЬ диалога, которая звучит именно в этом плане!

═══════════════════════════════════════════════════════════

📝 ФОРМАТ ДИАЛОГОВ:

**ИМЯ ЗАГЛАВНЫМИ (на отдельной строке)**
текст реплики

**БЕЗ двоеточия!**

✅ ПРАВИЛЬНО:
ТОМА
Проходите. Присаживайтесь

❌ НЕПРАВИЛЬНО:
ТОМА: Проходите

**Специальные метки:**
• **ГЗК** или **ЗК** - голос за кадром (персонаж говорит, но его не видно)
• Пример: ГАЛЯ ЗК - Галя говорит за кадром

**Формат с ГЗК:**
ГАЛЯ ГЗ
деньги у него всегда были

или

ГАЛЯ ЗК
В клубы.

═══════════════════════════════════════════════════════════

🎭 ЗАСТАВКА - ИСКЛЮЧЕНИЕ:

Заставка (opening credits) = ОДИН большой план (обычно 30-90 сек)

**Пример из реального монтажа:**
План 1: 00:00:00:00 - 00:00:04:09 | НДП | Логотип телекомпании
План 2: 00:00:04:09 - 00:01:06:13 | Ср. НДП | Заставка (62 секунды!)
План 3: 00:01:06:13 - 00:01:09:09 | Ср. НДП | Начало истории

**Заставка включает:**
- Логотипы
- Титры с актёрами
- Название сериала/фильма
- Музыку
- Короткие визуальные фрагменты

ВСЕ это в ОДНОМ плане!

═══════════════════════════════════════════════════════════

📖 ТИПЫ ПЛАНОВ (глоссарий):

**По крупности:**
• **Дальний** - человек очень маленький
• **Общ.** (Общий) - человек в полный рост
• **Ср.** (Средний) - по колени/пояс
• **Кр.** (Крупный) - голова и плечи
• **Деталь** - часть лица или предмет

**С надписями:**
• **НДП** - надписи на экране (титры)
• **Кр. НДП** - Крупный план + титры
• **Ср. НДП** - Средний план + титры

**Другие:**
• **ЗТМ** - затмение/fade to black

═══════════════════════════════════════════════════════════

📝 СОДЕРЖАНИЕ ПЛАНА:

**Формат:**
• Кратко: кто в кадре, что делает (1-2 предложения)
• Если есть титры - каждый на новой строке после слова "Титр"

✅ ПРАВИЛЬНО:
Тома идет по салону в белой форме, оборачивается.
Титр
Галина – Полина Нечитайло.
Титр
Юсеф – Олег Чудницов-Хартулари

❌ НЕПРАВИЛЬНО:
Тома идет по салону. Титр Галина – Полина Нечитайло. Титр Юсеф – Олег Чудницов-Хартулари

═══════════════════════════════════════════════════════════

🎵 МУЗЫКА:

• Если звучит фоновая музыка: "Музыка"
• Если важен стиль: "Музыка (народная)", "Музыка (восточная)"
• Если конкретные звуки: "Шум воды", "Телефонный звонок", "Смех"

═══════════════════════════════════════════════════════════

✨ ФОРМАТ ОТВЕТА:

**ЧЧ:ММ:СС:КК - ЧЧ:ММ:СС:КК**
*   **План:** [Тип плана]
*   **Содержание:** [Краткое описание, титры]
*   **Диалоги/Музыка:** [Диалоги ЭТОГО плана или Музыка]

═══════════════════════════════════════════════════════════

📚 ПРИМЕРЫ ИЗ РЕАЛЬНОГО МОНТАЖА:

**Пример 1: Простой план с диалогом**

**00:01:06:13 - 00:01:09:09**
*   **План:** Ср. НДП
*   **Содержание:** Тома идет по салону в белой форме, оборачивается.
    Титр
    Галина – Полина Нечитайло.
    Титр
    Юсеф – Олег Чудницов-Хартулари
*   **Диалоги/Музыка:**
    ТОМА
    Проходите. Присаживайтесь

**Пример 2: План без диалога (только действие)**

**00:01:29:20 - 00:01:30:19**
*   **План:** Кр.
*   **Содержание:** Галя хватается руками за живот
*   **Диалоги/Музыка:** Музыка

**Пример 3: Диалог разбит на несколько планов**

**00:01:22:09 - 00:01:23:14**
*   **План:** Кр.
*   **Содержание:** Тома говорит в кадре
*   **Диалоги/Музыка:**
    ТОМА
    вы знаете,

**00:01:23:14 - 00:01:24:12**
*   **План:** Кр.
*   **Содержание:** Тома моет руки
*   **Диалоги/Музыка:**
    ТОМА
    у нас

**00:01:24:12 - 00:01:29:20**
*   **План:** Кр. НДП
*   **Содержание:** Тома в кадре. Камера двигается в сторону, переходит на клиентку.
    Титр
    жены Анна Татренко, Инна Михайлова, Кристина Рубан, Анна Мешкова, Оксана Горбутовская
*   **Диалоги/Музыка:**
    ТОМА
    такая проблема?
    ГАЛЯ
    Проблема?

**Пример 4: Голос за кадром (ГЗК)**

**00:07:17:18 - 00:07:19:15**
*   **План:** Общ.
*   **Содержание:** Галя танцует в ресторане перед Юсефом восточные танцы.
*   **Диалоги/Музыка:**
    ГАЛЯ ГЗ
    деньги у него

**00:07:19:15 - 00:07:20:20**
*   **План:** Кр.
*   **Содержание:** Юсеф в кадре, смотрит на танцы Галины
*   **Диалоги/Музыка:**
    ГАЛЯ ЗК
    всегда были. Стал он

**Пример 5: Длинный диалог в одном плане**

**00:03:10:11 - 00:03:33:02**
*   **План:** Ср.
*   **Содержание:** Галя ловит в зале напарницу, спрашивает ее, записывает в блокнот.
*   **Диалоги/Музыка:**
    ГАЛЯ
    Тань, Тань. Танька скажи пожалуйста, а что такое почеревок? Я опять забыла
    ТАНЯ
    у тебя что голова сдурела что ли? Я тебе сколько раз говорила.
    ГАЛЯ
    ну у меня с твоим украинским ну никак.
    ТАНЯ
    он такой же твой, как и мой.
    ГАЛЯ
    ну там хоть была. А я из Балабанова своего не выезжала никогда.
    ТАНЯ
    вспомни ты теперь в Москве. Тут мозги надо иметь. Запоминай. Почеревок
    ГАЛЯ
    почеревок
    ТАНЯ
    это мясо с салом копченым
    ГАЛЯ
    ага.
    ТАНЯ
    ой глянь-ка чернявый-то как на тебя, прям

**Пример 6: Серия коротких планов**

**00:42:47:19 - 00:42:48:22**
*   **План:** Кр.
*   **Содержание:** Марина смотрит на Беллу.
*   **Диалоги/Музыка:** Музыка

**00:42:48:22 - 00:42:49:21**
*   **План:** Кр.
*   **Содержание:** Белла смотрит на Марину.
*   **Диалоги/Музыка:** Музыка

**00:42:49:21 - 00:42:50:20**
*   **План:** Кр.
*   **Содержание:** Марина смотрит на Беллу.
*   **Диалоги/Музыка:** Музыка

(Это монтажный прием "восьмерка" - быстрая смена планов в диалоге)

═══════════════════════════════════════════════════════════

🎬 АЛГОРИТМ РАБОТЫ:

**ШАГ 1: Найди все склейки**
Смотри видео, отмечай КАЖДЫЙ момент смены кадра

**ШАГ 2: Для каждой склейки:**
1. Засекай ТОЧНЫЙ таймкод начала и конца с плашки
2. Определи тип плана (Кр., Ср., Общ. и т.д.)
3. Опиши что в кадре (кратко!)
4. Укажи диалоги/музыку ЭТОГО плана

**ШАГ 3: Проверь стыковку**
Конец плана N = Начало плана N+1 (БЕЗ РАЗРЫВОВ!)

**ШАГ 4: Проверь диалоги**
• Если диалог длинный и идет через несколько планов - разбей его
• В каждом плане - только та часть, которая звучит в нём
• Если в плане нет диалога - укажи "Музыка" или звуки

═══════════════════════════════════════════════════════════

⚠️ ЧАСТЫЕ ОШИБКИ - НЕ ДОПУСКАЙ:

❌ **Объединение нескольких склеек в один план**
00:01:22:09 - 00:01:33:08  ← это 3-5 склеек, не один план!

❌ **Разрывы в таймкодах**
План: 00:01:22:09 - 00:01:23:14
План: 00:01:24:00 - 00:01:25:00  ← пропуск!

❌ **Потеря части диалога**
Реальность: ТОМА вы знаете, у нас такая проблема?
Твой ответ: ТОМА такая проблема?  ← потеряно начало!

❌ **Пропуск планов без диалога**
Ты: пропустил план, потому что там только "Галя хватается за живот"
Надо: КАЖДАЯ склейка = план, даже без диалога!

═══════════════════════════════════════════════════════════

📊 МЕТРИКА КАЧЕСТВА:

**Хороший монтажный лист:**
• ~20-25 планов в минуту (для динамичных сцен)
• ~10-15 планов в минуту (для спокойных сцен)
• 0 разрывов в таймкодах
• 0 пропущенных реплик диалога

**Плохой монтажный лист:**
• <10 планов в минуту (пропущены склейки!)
• Разрывы в таймкодах
• Потеря частей диалогов
• Объединение нескольких планов в один

═══════════════════════════════════════════════════════════

🎯 НАЧИНАЙ АНАЛИЗ:

1. Найди ЗАСТАВКУ (обычно первые 30-90 секунд) - опиши как ОДИН план
2. После заставки - анализируй КАЖДУЮ склейку отдельно
3. Для каждого плана: таймкод → тип → содержание → диалоги
4. ПРОВЕРЬ стыковку таймкодов (конец N = начало N+1)
5. Продолжай до КОНЦА видео

ПОМНИ: Лучше создать "лишний" план, чем пропустить склейку!

═══════════════════════════════════════════════════════════`;

export function createChunkPromptV2(
  chunkIndex: number,
  startTimecode: string,
  endTimecode: string,
  totalChunks: number
): string {
  if (totalChunks > 1) {
    return `${MONTAGE_ANALYSIS_PROMPT_V2}

═══════════════════════════════════════════════════════════

🚨 ТЫ ПОЛУЧИЛ ФРАГМЕНТ ВИДЕО:

Часть ${chunkIndex + 1} из ${totalChunks}

🎯 ИСПОЛЬЗУЙ ТАЙМКОДЫ ИЗ ВСТРОЕННОЙ ПЛАШКИ:
• Смотри на плашку в каждом кадре
• Используй ТОЧНЫЕ таймкоды с плашки
• НЕ вычисляй от 00:00:00, используй реальные!

Примерный диапазон: ${startTimecode} - ${endTimecode}

✅ Правильно: **00:19:35:05 - 00:19:38:12** (из плашки)
❌ Неправильно: **00:00:35:05 - 00:00:38:12** (выдуманный)

ВАЖНО:
• Если это НЕ первый чанк - видео начинается НЕ с 00:00:00!
• Первый план должен начинаться с таймкода близкого к ${startTimecode}
• Последний план должен заканчиваться близко к ${endTimecode}

Анализируй ВСЕ планы до конца фрагмента!`;
  }
  
  return MONTAGE_ANALYSIS_PROMPT_V2;
}











