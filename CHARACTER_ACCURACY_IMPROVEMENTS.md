# –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

## üìä –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º

–ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º –º–æ–Ω—Ç–∞–∂–Ω—ã–º –ª–∏—Å—Ç–æ–º –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π –≤—ã—è–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ë–≠–õ–õ–ê ‚Üí –ì–ê–õ–Ø** (Plan 595-597, 00:27:03-00:27:10)
2. **–ë–≠–õ–õ–ê ‚Üí –¢–û–ú–ê** (Plan 958-960, 00:42:00-00:42:06)
3. **–õ–Æ–î–ê–°–Ø ‚Üí –ì–ê–õ–Ø** (Plan 903-906, 00:39:00-00:39:07)
4. **–Æ–°–ï–§ —Ä–µ–ø–ª–∏–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è** (Plan 1016-1017, 00:45:00-00:45:01)

---

## üî¨ –ú–µ—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π (2024-2025)

### 1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ Face Presence Evidence**

**–ü—Ä–æ–±–ª–µ–º–∞:** Face Presence Evidence —Ä–∞–±–æ—Ç–∞–µ—Ç (15 entries), –Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å Face Presence Evidence –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç:
- **Temporal overlap** (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ): —á–µ–º –±–æ–ª—å—à–µ –ª–∏—Ü–æ –≤–∏–¥–Ω–æ –≤ –æ–∫–Ω–µ —Ä–µ—á–∏, —Ç–µ–º –≤—ã—à–µ –≤–µ—Å
- **Dominance** (–¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ): –µ—Å–ª–∏ –ª–∏—Ü–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç (>60%), —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å –≤ 2-3 —Ä–∞–∑–∞
- **Quality** (–∫–∞—á–µ—Å—Ç–≤–æ): –µ—Å–ª–∏ –ª–∏—Ü–æ –≤–∏–¥–Ω–æ —Ö–æ—Ä–æ—à–æ, —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/speaker-character-mapper.ts
const FACE_PRESENCE_WEIGHT_BASE = 2.5;
const FACE_PRESENCE_WEIGHT_HIGH_DOMINANCE = 5.0; // –ï—Å–ª–∏ dominance > 0.7
const FACE_PRESENCE_WEIGHT_PERFECT_OVERLAP = 6.0; // –ï—Å–ª–∏ face –≤–∏–¥–Ω–æ >80% –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ—á–∏

addFacePresenceEvidence(evidence: FacePresenceEvidence[]): void {
  for (const ev of evidence) {
    if (ev.dominance < 0.5) continue;
    
    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤–µ—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç dominance
    let dynamicWeight = FACE_PRESENCE_WEIGHT_BASE;
    if (ev.dominance > 0.7) {
      dynamicWeight = FACE_PRESENCE_WEIGHT_HIGH_DOMINANCE;
    }
    if (ev.dominance > 0.8) {
      dynamicWeight = FACE_PRESENCE_WEIGHT_PERFECT_OVERLAP;
    }
    
    this.addEvidence(ev.speakerId, {
      type: 'face_presence',
      character: ev.characterName,
      weight: ev.dominance * dynamicWeight, // –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤–µ—Å
      timestamp: ev.startMs,
    });
  }
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:** Face Presence Evidence –±—É–¥–µ—Ç –∏–º–µ—Ç—å –±–æ–ª—å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –ª–∏—Ü–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç –≤ –∫–∞–¥—Ä–µ.

---

### 2. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (Temporal Alignment)**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–∫–Ω–æ ¬±2 —Å–µ–∫—É–Ω–¥—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ –æ–∫–Ω–æ –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è:
- **Forward window** (–≤–ø–µ—Ä—ë–¥): 3-4 —Å–µ–∫—É–Ω–¥—ã (—Ä–µ—á—å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –ª–∏—Ü–∞)
- **Backward window** (–Ω–∞–∑–∞–¥): 1-1.5 —Å–µ–∫—É–Ω–¥—ã (–ª–∏—Ü–æ –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è —á—É—Ç—å —Ä–∞–Ω—å—à–µ —Ä–µ—á–∏)
- **Overlap threshold**: –º–∏–Ω–∏–º—É–º 50% –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ—á–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –Ω–∞–ª–∏—á–∏–µ–º –ª–∏—Ü–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// app/api/init-processing-v5/route.ts - STEP 4.5

const FORWARD_WINDOW_FACE = 3500;  // 3.5 —Å–µ–∫—É–Ω–¥—ã –≤–ø–µ—Ä—ë–¥ (—É–≤–µ–ª–∏—á–µ–Ω–æ)
const BACKWARD_WINDOW_FACE = 1500; // 1.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞–∑–∞–¥ (—É–≤–µ–ª–∏—á–µ–Ω–æ)
const MIN_OVERLAP_RATIO = 0.5;     // –ú–∏–Ω–∏–º—É–º 50% –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ—á–∏ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å

for (const [speakerId, words] of wordsBySpeaker) {
  const speechStartSec = words[0].startMs / 1000;
  const speechEndSec = words[words.length - 1].endMs / 1000;
  const speechDuration = speechEndSec - speechStartSec;
  
  for (const cluster of faceClusters) {
    if (!cluster.characterName) continue;
    const timestamps = cluster.faceTimestamps || [];
    
    // –ù–∞—Ö–æ–¥–∏–º –ª–∏—Ü–∞ –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º –æ–∫–Ω–µ
    const facesInWindow = timestamps.filter(faceTime =>
      faceTime >= speechStartSec - BACKWARD_WINDOW_FACE &&
      faceTime <= speechEndSec + FORWARD_WINDOW_FACE
    );
    
    if (facesInWindow.length === 0) continue;
    
    // –í—ã—á–∏—Å–ª—è–µ–º overlap (—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ª–∏—Ü–æ –≤–∏–¥–Ω–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ä–µ—á–∏)
    const faceDuration = facesInWindow.length * FRAME_INTERVAL; // 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
    const overlap = Math.min(faceDuration, speechDuration) / speechDuration;
    
    // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ overlap –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–π
    if (overlap >= MIN_OVERLAP_RATIO) {
      // –î–æ–±–∞–≤–ª—è–µ–º evidence —Å –≤–µ—Å–æ–º, –∑–∞–≤–∏—Å—è—â–∏–º –æ—Ç overlap
      // ...
    }
  }
}
```

---

### 3. **Feature-Level Fusion –≤–º–µ—Å—Ç–æ Score-Level**

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç score-level fusion (–ø—Ä–æ—Å—Ç–æ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º –≤–µ—Å–∞). –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ feature-level fusion –¥–∞—ë—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≥–æ–ª–æ—Å–∞ –∏ –ª–∏—Ü–∞ –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cosine similarity –º–µ–∂–¥—É voice embedding –∏ face embedding
- –ï—Å–ª–∏ similarity –≤—ã—Å–æ–∫–∞—è (>0.7), —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –ï—Å–ª–∏ similarity –Ω–∏–∑–∫–∞—è (<0.3), —É–º–µ–Ω—å—à–∏—Ç—å –≤–µ—Å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/speaker-character-mapper.ts

interface VoiceFaceFusion {
  speakerId: string;
  faceClusterId: string;
  voiceEmbedding: number[];
  faceEmbedding: number[];
  similarity: number; // 0-1
}

addVoiceFaceFusionEvidence(fusions: VoiceFaceFusion[]): void {
  for (const fusion of fusions) {
    if (fusion.similarity < 0.3) continue; // –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å
    
    // –ï—Å–ª–∏ similarity –≤—ã—Å–æ–∫–∞—è, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å –æ–±–æ–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    const fusionBonus = fusion.similarity > 0.7 ? 2.0 : 1.0;
    
    // –î–æ–±–∞–≤–ª—è–µ–º evidence —Å –±–æ–Ω—É—Å–æ–º –∑–∞ fusion
    // ...
  }
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ voice embeddings —Å face embeddings.

---

### 4. **–£—Å–∏–ª–µ–Ω–∏–µ Active Speaker Detection**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–∏ –ª–∏—Ü–æ –≥–æ–≤–æ—Ä–∏—Ç (–¥–≤–∏–∂–µ–Ω–∏—è —Ä—Ç–∞, –º–∏–º–∏–∫–∞).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–≤–∏–∂–µ–Ω–∏–π —Ä—Ç–∞/–º–∏–º–∏–∫–∏:
- –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–π —Ä–æ—Ç –≤ –∫–∞–¥—Ä–µ
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –≥—É–± –≤–æ –≤—Ä–µ–º—è —Ä–µ—á–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ —Ç–∏–ø–∞ SyncNet –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ—á–∏ –∏ –ª–∏—Ü–∞

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/face-presence-detector.ts

interface ActiveSpeakerResult {
  isActive: boolean;
  confidence: number; // 0-1
  mouthOpen: boolean;
  lipMovement: number; // 0-1, –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è –≥—É–±
}

function detectActiveSpeaker(
  faceTimestamp: number,
  speechWindow: SpeechWindow,
  videoFrame?: Buffer
): ActiveSpeakerResult {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –ª–∏—Ü–æ –≤ –æ–∫–Ω–æ —Ä–µ—á–∏
  const faceTimeMs = faceTimestamp * 1000;
  const inSpeechWindow = faceTimeMs >= speechWindow.startMs && 
                         faceTimeMs <= speechWindow.endMs;
  
  if (!inSpeechWindow) {
    return { isActive: false, confidence: 0, mouthOpen: false, lipMovement: 0 };
  }
  
  // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ –∫–∞–¥—Ä, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–≤–∏–∂–µ–Ω–∏–π —Ä—Ç–∞
  // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–∑–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
  return {
    isActive: true,
    confidence: 0.8, // –ë–∞–∑–æ–≤–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
    mouthOpen: true, // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Ä–æ—Ç –æ—Ç–∫—Ä—ã—Ç
    lipMovement: 0.7, // –°—Ä–µ–¥–Ω—è—è –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
  };
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏–π —Ä—Ç–∞.

---

### 5. **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞—é—Ç —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å priority-based resolution:
1. **Face Presence + High Dominance** (>0.7) –∏–º–µ–µ—Ç –≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
2. **Alignment + High Score** (>0.8) –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
3. **Voice Embedding + Face Presence** –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –∏–º–µ–µ—Ç –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
4. –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–ª–∞–±—ã–µ ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/speaker-character-mapper.ts - buildMapping()

// –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞:
const priorityRules = [
  // –ü—Ä–∞–≤–∏–ª–æ 1: Face Presence + High Dominance
  (sources: EvidenceSource[]) => {
    const faceEvidence = sources.filter(s => 
      s.type === 'face_presence' && s.weight > 5.0
    );
    return faceEvidence.length > 0 ? faceEvidence[0].character : null;
  },
  
  // –ü—Ä–∞–≤–∏–ª–æ 2: Alignment + High Score
  (sources: EvidenceSource[]) => {
    const alignmentEvidence = sources.filter(s => 
      s.type === 'alignment' && s.weight > 2.5
    );
    return alignmentEvidence.length > 0 ? alignmentEvidence[0].character : null;
  },
  
  // –ü—Ä–∞–≤–∏–ª–æ 3: Majority vote —Å—Ä–µ–¥–∏ —Å–∏–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
  (sources: EvidenceSource[]) => {
    const strongSources = sources.filter(s => s.weight > 2.0);
    if (strongSources.length === 0) return null;
    
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º –∏ —Å—á–∏—Ç–∞–µ–º
    const charCounts = new Map<string, number>();
    for (const s of strongSources) {
      charCounts.set(s.character, (charCounts.get(s.character) || 0) + 1);
    }
    
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
    let maxCount = 0;
    let bestChar = null;
    for (const [char, count] of charCounts) {
      if (count > maxCount) {
        maxCount = count;
        bestChar = char;
      }
    }
    return bestChar;
  },
];
```

---

### 6. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∞—Ç—Ä–∏–±—É—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã:
- –ï—Å–ª–∏ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —É–∫–∞–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è, —É–≤–µ–ª–∏—á–∏—Ç—å –≤–µ—Å
- –ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ü–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º, –Ω–æ –¥—Ä—É–≥–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–∏–ª—å–Ω—ã–µ, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ–≤–∏–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
// lib/speaker-character-mapper.ts

interface ScriptValidationEvidence {
  speakerId: string;
  timestamp: number;
  expectedCharacter: string;
  confidence: number; // –ù–∞—Å–∫–æ–ª—å–∫–æ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂ –∏–∑ —Å—Ü–µ–Ω–∞—Ä–∏—è
}

addScriptValidationEvidence(validations: ScriptValidationEvidence[]): void {
  for (const val of validations) {
    this.addEvidence(val.speakerId, {
      type: 'alignment', // –ò—Å–ø–æ–ª—å–∑—É–µ–º alignment –¥–ª—è script validation
      character: val.expectedCharacter,
      weight: val.confidence * EVIDENCE_WEIGHTS.alignment * 1.5, // –ë–æ–Ω—É—Å 50% –∑–∞ script validation
      timestamp: val.timestamp,
    });
  }
}
```

---

### 7. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∞ –≤–µ—Å–æ–≤**

**–¢–µ–∫—É—â–∏–µ –≤–µ—Å–∞:**
```typescript
alignment: 3.0
face_presence: 2.5
voice_embedding: 1.2
name_mention: 1.0
gemini_hint: 0.3
```

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –≤–µ—Å–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π):**
```typescript
// –ë–∞–∑–æ–≤—ã–µ –≤–µ—Å–∞
alignment: 3.0          // –û—Å—Ç–∞—ë—Ç—Å—è —Å–∏–ª—å–Ω—ã–º
face_presence_base: 2.5 // –ë–∞–∑–æ–≤—ã–π
face_presence_high: 5.0 // –ï—Å–ª–∏ dominance > 0.7
face_presence_perfect: 6.0 // –ï—Å–ª–∏ dominance > 0.8 –∏ overlap > 0.7
voice_embedding: 1.5    // –£–≤–µ–ª–∏—á–µ–Ω–æ
name_mention: 1.2       // –£–≤–µ–ª–∏—á–µ–Ω–æ
gemini_hint: 0.3        // –û—Å—Ç–∞—ë—Ç—Å—è —Å–ª–∞–±—ã–º

// Fusion –±–æ–Ω—É—Å—ã
voice_face_fusion: 2.0  // –ï—Å–ª–∏ voice + face —Å–æ–≤–ø–∞–¥–∞—é—Ç
script_validation: 1.5  // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–º
```

---

## üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–±—ã—Å—Ç—Ä–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ):
1. ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ Face Presence** ‚Äî –º–æ–∂–Ω–æ –≤–Ω–µ–¥—Ä–∏—Ç—å —Å—Ä–∞–∑—É
2. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ–∫–æ–Ω
3. ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** ‚Äî priority-based resolution

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã):
4. ‚ö†Ô∏è **Feature-Level Fusion** ‚Äî —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ voice + face embeddings
5. ‚ö†Ô∏è **Active Speaker Detection** ‚Äî —Ç—Ä–µ–±—É–µ—Ç –º–æ–¥–µ–ª–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏–π —Ä—Ç–∞

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è):
6. üîÑ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏** ‚Äî –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
7. üîÑ **–ü–æ–ª–Ω–∞—è —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** ‚Äî —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º–µ—Ä –≤—ã—Å–æ–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:
- **–ë–≠–õ–õ–ê ‚Üí –ì–ê–õ–Ø**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (Face Presence —Å –≤—ã—Å–æ–∫–∏–º dominance –±—É–¥–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–º)
- **–ë–≠–õ–õ–ê ‚Üí –¢–û–ú–ê**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (—É–ª—É—á—à–µ–Ω–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- **–õ–Æ–î–ê–°–Ø ‚Üí –ì–ê–õ–Ø**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (priority-based resolution)
- **–Æ–°–ï–§ —Ä–µ–ø–ª–∏–∫–∏**: —á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (—É–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **Precision/Recall** –¥–ª—è —Å–≤—è–∑–∏ speaker ‚Üí character
2. **F1-score** –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–ë–≠–õ–õ–ê, –õ–Æ–î–ê–°–Ø, –¢–û–ú–ê)
3. **Confidence distribution** ‚Äî –∫–∞–∫ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è high confidence (>0.8)
4. **Evidence source distribution** ‚Äî –∫–∞–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –í–Ω–µ–¥—Ä–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ Face Presence Evidence
2. –£–≤–µ–ª–∏—á–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. –î–æ–±–∞–≤–∏—Ç—å priority-based resolution –¥–ª—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º –º–æ–Ω—Ç–∞–∂–Ω—ã–º –ª–∏—Å—Ç–æ–º
5. –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ —É–ª—É—á—à–∞—Ç—å –≤–µ—Å–∞ –∏ –ø–æ—Ä–æ–≥–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
