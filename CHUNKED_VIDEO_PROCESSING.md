# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (Chunked Processing)

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –Ω–∞ —á–∞—Å—Ç–∏ (chunks) –ø–æ 20 –º–∏–Ω—É—Ç —Å –Ω–∞—Ö–ª–µ—Å—Ç–æ–º 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —á–µ—Ä–µ–∑ Gemini AI.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **lib/video-chunking.ts** - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–∑–±–∏–≤–∫–∏ –≤–∏–¥–µ–æ –Ω–∞ —á–∞–Ω–∫–∏
   - `createVideoChunks()` - —Å–æ–∑–¥–∞–µ—Ç —á–∞–Ω–∫–∏ —Å –Ω–∞—Ö–ª–µ—Å—Ç–æ–º
   - `secondsToTimecode()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ–∫—É–Ω–¥—ã –≤ HH:MM:SS
   - `timecodeToSeconds()` - –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞–π–º–∫–æ–¥ –≤ —Å–µ–∫—É–Ω–¥—ã
   - `deduplicateScenes()` - —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã —Å—Ü–µ–Ω

2. **lib/gemini-prompt.ts** - –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è Gemini
   - `createChunkPrompt()` - —Å–æ–∑–¥–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
   - –ò–Ω—Å—Ç—Ä—É–∫—Ç–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ç–∞–π–º–∫–æ–¥—ã

3. **lib/replicate-helper.ts** - ‚≠ê **–ù–û–í–û–ï** - Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è Replicate
   - `createPredictionWithRetry()` - —Å–æ–∑–¥–∞–Ω–∏–µ prediction —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retry (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
   - `pollPrediction()` - –æ–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º –∏ –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
   - –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (2s, 4s, 6s)

4. **app/api/process-video-chunked/route.ts** - API endpoint
   - –†–∞–∑–±–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –Ω–∞ —á–∞–Ω–∫–∏
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π —á–∞–Ω–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å retry
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç overlap –∑–æ–Ω—ã
   - Graceful error handling –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞
   - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

5. **components/UploadModalLong.tsx** - UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ HTML5 Video API
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç duration –∏ skipAutoProcess –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ

```typescript
// –í –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–ª—É—á–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
const video = document.createElement('video');
video.src = URL.createObjectURL(file);
video.onloadedmetadata = () => {
  const duration = Math.floor(video.duration); // —Å–µ–∫—É–Ω–¥—ã
};
```

### 2. –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —á–∞–Ω–∫–∏

```typescript
// –î–ª—è –≤–∏–¥–µ–æ 45 –º–∏–Ω—É—Ç (2700 —Å–µ–∫—É–Ω–¥):
const chunks = createVideoChunks(2700);
// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// Chunk 0: 00:00:00 - 00:20:00
// Chunk 1: 00:19:45 - 00:39:45 (overlap 15 —Å–µ–∫)
// Chunk 2: 00:39:30 - 00:45:00 (overlap 15 —Å–µ–∫)
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞ (—Å retry –ª–æ–≥–∏–∫–æ–π)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —Ç–∞–π–º–∫–æ–¥–∞–º
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –≤ Gemini —á–µ—Ä–µ–∑ Replicate **—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ retry** (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
3. –û–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞ prediction —Å —Ç–∞–π–º–∞—É—Ç–æ–º
4. –ü–∞—Ä—Å–∏—Ç—Å—è –æ—Ç–≤–µ—Ç
5. –£–¥–∞–ª—è—é—Ç—Å—è —Å—Ü–µ–Ω—ã –∏–∑ overlap –∑–æ–Ω—ã (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —á–∞–Ω–∫–∞)

**Retry –ª–æ–≥–∏–∫–∞** (`lib/replicate-helper.ts`):
- –î–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è prediction
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (2s, 4s, 6s)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 4. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```typescript
// –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å—Ü–µ–Ω—ã –∏–∑ –≤—Å–µ—Ö —á–∞–Ω–∫–æ–≤
allParsedScenes = chunk1Scenes + chunk2Scenes + chunk3Scenes;

// –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
dedupedScenes = deduplicateScenes(allParsedScenes);
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

```typescript
const CHUNK_DURATION = 20 * 60; // 20 –º–∏–Ω—É—Ç
const OVERLAP_DURATION = 15;     // 15 —Å–µ–∫—É–Ω–¥
```

## UI

### –î–≤–µ –∫–Ω–æ–ø–∫–∏ –≤ –¥–∞—à–±–æ—Ä–¥–µ:

1. **"–ù–æ–≤—ã–π –ª–∏—Å—Ç"** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å)
2. **"–î–ª–∏–Ω–Ω–æ–µ –≤–∏–¥–µ–æ"** - chunked –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å)

### –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤ –º–æ–¥–∞–ª–µ –¥–ª–∏–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ:

- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (>20 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª–µ duration –≤ —Ç–∞–±–ª–∏—Ü–µ videos:

```sql
duration INTEGER -- –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

–ü–æ–ª–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —á–µ—Ä–µ–∑ UploadModalLong.

## API Endpoints

### POST /api/upload
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç:
- `file` - –≤–∏–¥–µ–æ —Ñ–∞–π–ª
- `userId` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `duration` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `skipAutoProcess` - 'true' –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–ª—è chunked –ø—Ä–æ—Ü–µ—Å—Å–∞)

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ `skipAutoProcess='true'`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è. 
–≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `UploadModalLong` –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ chunked –ø—Ä–æ—Ü–µ—Å—Å–∞.

### GET /api/videos/[id]
–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∏–¥–µ–æ –∏ —Å–æ–∑–¥–∞–µ—Ç signed URL
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- `video` - –æ–±—ä–µ–∫—Ç –≤–∏–¥–µ–æ
- `signedUrl` - –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 2 —á–∞—Å–∞)

### POST /api/process-video
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–±–µ–∑ chunking)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ `/api/upload` –µ—Å–ª–∏ `skipAutoProcess` –Ω–µ —É–∫–∞–∑–∞–Ω.

### POST /api/process-video-chunked
–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å chunking
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç:
- `videoId` - ID –≤–∏–¥–µ–æ
- `videoUrl` - signed URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
- `videoDuration` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏–∑ `UploadModalLong` –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è chunked –ø—Ä–æ—Ü–µ—Å—Å–∞:

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–ª–∏–Ω–Ω–æ–µ –≤–∏–¥–µ–æ"
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ (–ª—é–±–æ–π –¥–ª–∏–Ω—ã, –Ω–æ >20 –º–∏–Ω—É—Ç –¥–ª—è chunking)
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
   - –†–∞–∑–æ–±—å–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   - –û–±—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –õ–æ–≥–∏

–í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã:
```
üé¨ Processing video {id} in {N} chunk(s)
üìπ Processing chunk 1/N: 00:00:00 - 00:20:00
‚úÖ Chunk 1 succeeded!
üìä Total scenes so far: X
üéâ All chunks processed! Total scenes: X
After deduplication: X scenes
‚úÖ Video processing completed successfully
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ –ª—é–±–æ–π –¥–ª–∏–Ω—ã
2. ‚úÖ –ù–∞—Ö–ª–µ—Å—Ç –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é —Å—Ü–µ–Ω –Ω–∞ —Å—Ç—ã–∫–∞—Ö
3. ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —É–±–∏—Ä–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä—ã
4. ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. ‚úÖ –ù–µ –ª–æ–º–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è)
- Timeout 10 –º–∏–Ω—É—Ç –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å)
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Replicate API limits

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: 405 Method Not Allowed –Ω–∞ /api/videos/[id]
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω GET –º–µ—Ç–æ–¥ –≤ endpoint `/api/videos/[id]/route.ts`

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–º–µ—Å—Ç–æ chunked
**–ü—Ä–∏—á–∏–Ω–∞:** `/api/upload` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–ª `/api/process-video` –¥–ª—è –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∑–æ–∫

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `skipAutoProcess` –≤ `/api/upload`
- `UploadModalLong` –ø–µ—Ä–µ–¥–∞–µ—Ç `skipAutoProcess='true'`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ chunked –ø—Ä–æ—Ü–µ—Å—Å

### –ü—Ä–æ–±–ª–µ–º–∞: Replicate –æ—à–∏–±–∫–∞ "Director: unexpected error handling prediction (E6716)"
**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Replicate API (–Ω–µ —Å–≤—è–∑–∞–Ω–æ —Å –Ω–∞—à–∏–º –∫–æ–¥–æ–º)

**–ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è retry –ª–æ–≥–∏–∫–∞ (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)
- ‚úÖ –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ Graceful error handling –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —á–∞–Ω–∫–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
1. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ** (5-10 –º–∏–Ω—É—Ç –¥–ª—è —Ç–µ—Å—Ç–∞)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –≤–∏–¥–µ–æ:**
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: MP4 —Å H.264 –∫–æ–¥–µ–∫–æ–º
   - –†–∞–∑–º–µ—Ä: <100MB –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: –¥–æ 1080p
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Replicate:** https://replicate.com/status
4. **–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å** –µ—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ä—É–µ—Ç
5. **–ü–æ–¥–æ–∂–¥–∞—Ç—å 15-30 –º–∏–Ω—É—Ç** - —á–∞—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ chunked –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
Skipping auto-process for video: {id} (will be processed via chunked endpoint)
üé¨ Processing video {id} in 3 chunk(s): [...]
üìπ Processing chunk 1/3: 00:00:00 - 00:20:00
Chunk prompt length: 2939
Attempt 1/3 to create prediction...
‚úÖ Prediction created successfully on attempt 1: {predictionId}
Polling attempt 1/60: starting
Polling attempt 2/60: processing
...
Polling attempt N/60: succeeded
‚úÖ Chunk 1 succeeded!
Chunk 1 parsed scenes count: X
üìä Total scenes so far: X
üìπ Processing chunk 2/3: 00:19:45 - 00:39:45
...
üéâ All chunks processed! Total scenes: X
After deduplication: X scenes
‚úÖ Video processing completed successfully
```

–ü—Ä–∏ retry –ø–æ–ø—ã—Ç–∫–∞—Ö (–µ—Å–ª–∏ –ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ —É–ø–∞–ª–∞):
```
Attempt 1/3 to create prediction...
‚ùå Attempt 1/3 failed: {error}
‚è≥ Waiting 2000ms before retry...
Attempt 2/3 to create prediction...
‚úÖ Prediction created successfully on attempt 2: {predictionId}
```

–ü—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ (—Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å):
```
Created signed URL for video: {id}
Creating Replicate prediction for video: {id}
```

## –î–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–∞–Ω–∫–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –ø–æ —á–∞–Ω–∫–∞–º
3. –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è recovery
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä overlap –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
5. –î–æ–±–∞–≤–∏—Ç—å retry logic –¥–ª—è failed chunks

