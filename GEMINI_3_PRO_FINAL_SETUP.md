# ‚úÖ –§–ò–ù–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê: Gemini 3 Pro + –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéØ –ß–¢–û –ù–ê–°–¢–†–û–ï–ù–û:

### 1. –ú–æ–¥–µ–ª—å: Gemini 3 Pro
```typescript
model: 'google/gemini-3-pro'
```

### 2. Thinking Level: HIGH
```typescript
thinking_level: 'high'  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ 'low' –∏–ª–∏ 'high')
```

### 3. Input Format:
```typescript
{
  video: chunkStorageUrl,  // Singular (–Ω–µ –º–∞—Å—Å–∏–≤!)
  prompt: MONTAGE_ANALYSIS_PROMPT,
  thinking_level: 'high',
}
```

### 4. –ü—Ä–æ–º–ø—Ç:
- ‚úÖ **–ü–û–õ–ù–´–ô** —Å—Ç–∞—Ä—ã–π –ø—Ä–æ–º–ø—Ç (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ git)
- ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ –∫–∞–¥—Ä—ã (–ß–ß:–ú–ú:–°–°:–ö–ö)
- ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ –∏–º–µ–Ω–∞, –¥–∏–∞–ª–æ–≥–∏, —Ç–∏—Ç—Ä—ã
- ‚úÖ –ß–∞–Ω–∫–∏ –ø–æ 10 –º–∏–Ω—É—Ç

### 5. –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫:
- ‚úÖ –ü–æ–ª–Ω—ã–π JSON –æ—Ç–≤–µ—Ç–∞ –æ—Ç Replicate
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ (E6716, E004, E001, 429)
- ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è 429 QUOTA EXHAUSTED
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ chunk storage URL

---

## üìä –û–ë–ù–û–í–õ–Å–ù–ù–´–ï –§–ê–ô–õ–´:

1. **`app/api/process-chunk/route.ts`**
   - model: 'google/gemini-3-pro'
   - thinking_level: 'high'
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ chunk URL

2. **`app/api/process-video/route.ts`**
   - model: 'google/gemini-3-pro'
   - thinking_level: 'high'

3. **`app/api/process-video-chunked/route.ts`**
   - model: 'google/gemini-3-pro'
   - thinking_level: 'high'

4. **`lib/replicate-helper.ts`**
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ 429 QUOTA EXHAUSTED
   - –ü–æ–ª–Ω—ã–π JSON dump –ø—Ä–∏ –æ—à–∏–±–∫–µ

5. **`lib/gemini-prompt.ts`**
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ä—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ–º–ø—Ç
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã —á–∞–Ω–∫–∏ (10 –º–∏–Ω—É—Ç –≤–º–µ—Å—Ç–æ 20)

---

## üîç –ß–¢–û –°–ú–û–¢–†–ï–¢–¨ –í –õ–û–ì–ê–•:

### –ï—Å–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è E001 —Å–Ω–æ–≤–∞:

```
‚ùå Prediction failed with status: failed
‚ùå Error message: An error occurred while processing your request (E001) (1cah9wlWR9)
‚ùå Full result: { ... –¥–µ—Ç–∞–ª—å–Ω—ã–π JSON ... }
```

**–°–º–æ—Ç—Ä–∏ Full result** - —Ç–∞–º –±—É–¥–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞!

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã E001:

1. **429 RESOURCE_EXHAUSTED** - –ö–≤–æ—Ç–∞ Google Gemini API –∏—Å—á–µ—Ä–ø–∞–Ω–∞
   ```
   ‚ö†Ô∏è  429 QUOTA EXHAUSTED! Google Gemini API quota exceeded.
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å https://aistudio.google.com/app/apikey –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏ –¥–æ —Å–±—Ä–æ—Å–∞

2. **Video URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - Replicate –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
   ```
   Error: Failed to download video from URL
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ Public URLs —Ä–∞–±–æ—Ç–∞—é—Ç

3. **File format issue** - –§–æ—Ä–º–∞—Ç –≤–∏–¥–µ–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
   ```
   Error: Invalid video format
   ```
   **–†–µ—à–µ–Ω–∏–µ:** FFmpeg copy –¥–æ–ª–∂–µ–Ω –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π MP4

4. **Timeout** - –í–∏–¥–µ–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ/–¥–ª–∏–Ω–Ω–æ–µ
   ```
   Error: Processing timeout
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –£–º–µ–Ω—å—à–∏—Ç—å chunk size –µ—â–µ –±–æ–ª—å—à–µ

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä:
```bash
npm run dev
```

### 2. –ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ:
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ –∂–µ –≤–∏–¥–µ–æ (24 –º–∏–Ω / 147 MB)
- –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### 3. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –ª–æ–≥–∏:

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ prediction:**
```
üöÄ Starting Replicate prediction for chunk 0...
üìπ Chunk storage URL: https://goykmdyodqhptkzfgumq.supabase.co/storage/v1/object/public/videos/...
‚úÖ Prediction created successfully: xyz123
```

**–ü—Ä–∏ –æ—à–∏–±–∫–µ:**
```
‚ùå Prediction failed with status: failed
‚ùå Error message: [–î–ï–¢–ê–õ–¨–ù–ê–Ø –ü–†–ò–ß–ò–ù–ê]
‚ùå Full result: { ... JSON ... }
```

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:

### –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ –ù–ï –∏—Å—á–µ—Ä–ø–∞–Ω–∞:

```
‚úÖ Prediction created successfully
‚è≥ Polling prediction...
Polling attempt 3/90: processing
Polling attempt 15/90: processing
...
Polling attempt 45/90: succeeded
‚úÖ Chunk 0 AI response received (8500 chars)
üìä Parsed 65 scenes from chunk 0  ‚Üê –ú–ù–û–ì–û –ë–û–õ–¨–®–ï!
```

### –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ –∏—Å—á–µ—Ä–ø–∞–Ω–∞:

```
‚ùå Prediction failed with status: failed
‚ùå Error message: An error occurred... 429 RESOURCE_EXHAUSTED
‚ö†Ô∏è  429 QUOTA EXHAUSTED! Google Gemini API quota exceeded.
```

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å –∫–≤–æ—Ç—É –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò THINKING LEVEL:

–°–µ–π—á–∞—Å —Å—Ç–æ–∏—Ç **'high'** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏.

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å:

```typescript
thinking_level: 'low'  // –ë—ã—Å—Ç—Ä–æ, –Ω–æ –º–µ–Ω—å—à–µ –ø–ª–∞–Ω–æ–≤
```

–ù–æ –ø–æ–º–Ω–∏: —Å 'low' –ø–æ–ª—É—á–∞–ª–æ—Å—å **—Ç–æ–ª—å–∫–æ 31 –ø–ª–∞–Ω** –Ω–∞ 24 –º–∏–Ω—É—Ç—ã!

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ:

```typescript
thinking_level: 'high'  // –ú–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –ú–ù–û–ì–û –±–æ–ª—å—à–µ –ø–ª–∞–Ω–æ–≤
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π **'high'** –¥–ª—è production!

---

## üí° PLAN B: –ï—Å–ª–∏ Gemini 3 Pro –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤ –æ–∫–∞–∂–µ—Ç—Å—è —á—Ç–æ:
- –ö–≤–æ—Ç–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏—Å—á–µ—Ä–ø–∞–Ω–∞
- –°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ
- –°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ

**–ú–æ–∂–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:**
1. **Gemini 2.5 Flash** —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
2. **Claude 3.5 Sonnet** —á–µ—Ä–µ–∑ Replicate
3. **GPT-4 Vision** –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
4. –ü—Ä—è–º–æ–π **Google AI Studio API** (–±–µ–∑ Replicate)

---

## üöÄ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!

```bash
npm run dev
```

**–ó–∞–≥—Ä—É–∑–∏ –≤–∏–¥–µ–æ –∏ —Å–º–æ—Ç—Ä–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏!**

–¢–µ–ø–µ—Ä—å –º—ã —É–≤–∏–¥–∏–º **—Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É** –æ—à–∏–±–æ–∫ E001.

---

**–î–∞–π –∑–Ω–∞—Ç—å —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ª–æ–≥–∏!** üìä



